"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/(main)/returns/page",{

/***/ "(app-pages-browser)/./src/lib/firebase/services/returns.service.ts":
/*!******************************************************!*\
  !*** ./src/lib/firebase/services/returns.service.ts ***!
  \******************************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   returnsService: function() { return /* binding */ returnsService; }\n/* harmony export */ });\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/firestore */ \"(app-pages-browser)/./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n/* harmony import */ var _lib_firebase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/firebase */ \"(app-pages-browser)/./src/lib/firebase.ts\");\n/* harmony import */ var _base_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./base.service */ \"(app-pages-browser)/./src/lib/firebase/services/base.service.ts\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/constants */ \"(app-pages-browser)/./src/constants/index.ts\");\n\n\n\n\nclass ReturnsService extends _base_service__WEBPACK_IMPORTED_MODULE_2__.BaseService {\n    async getReturnRequests() {\n        try {\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, this.collectionName), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.orderBy)(\"requestedAt\", \"desc\"));\n            const snapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            const data = snapshot.docs.map((doc)=>({\n                    id: doc.id,\n                    ...doc.data()\n                }));\n            return {\n                success: true,\n                data\n            };\n        } catch (error) {\n            return this.handleError(error);\n        }\n    }\n    async createReturnRequest(input, userId) {\n        try {\n            const { imei, reason } = input;\n            if (!imei || !imei.trim()) {\n                return {\n                    success: false,\n                    error: \"IMEI kh\\xf4ng được để trống\"\n                };\n            }\n            const trimmedImei = imei.trim();\n            // Check if a pending return request for this IMEI already exists\n            const existingReturnQuery = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.RETURN_REQUESTS), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"imei\", \"==\", trimmedImei), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"status\", \"==\", \"pending\"));\n            const existingReturnSnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(existingReturnQuery);\n            if (!existingReturnSnapshot.empty) {\n                return {\n                    success: false,\n                    error: \"Đ\\xe3 tồn tại y\\xeau cầu trả h\\xe0ng cho IMEI n\\xe0y.\"\n                };\n            }\n            // 1. Find inventory item by IMEI\n            const inventoryRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.INVENTORY);\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)(inventoryRef, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"imei\", \"==\", trimmedImei));\n            const inventorySnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            if (inventorySnapshot.empty) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy sản phẩm với IMEI n\\xe0y\"\n                };\n            }\n            const inventoryItemDoc = inventorySnapshot.docs[0];\n            const inventoryItem = {\n                id: inventoryItemDoc.id,\n                ...inventoryItemDoc.data()\n            };\n            if (inventoryItem.status !== _constants__WEBPACK_IMPORTED_MODULE_3__.PRODUCT_STATUS.SOLD || !inventoryItem.salesOrderId) {\n                return {\n                    success: false,\n                    error: \"Sản phẩm n\\xe0y chưa được b\\xe1n hoặc kh\\xf4ng c\\xf3 th\\xf4ng tin đơn h\\xe0ng\"\n                };\n            }\n            const salesOrderRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.SALES_ORDERS, inventoryItem.salesOrderId);\n            const salesOrderDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(salesOrderRef);\n            if (!salesOrderDoc.exists()) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy đơn h\\xe0ng tương ứng\"\n                };\n            }\n            const salesOrder = {\n                id: salesOrderDoc.id,\n                ...salesOrderDoc.data()\n            };\n            const itemsSubcollectionRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(salesOrderRef, _constants__WEBPACK_IMPORTED_MODULE_3__.SUBCOLLECTIONS.ITEMS);\n            const qItems = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)(itemsSubcollectionRef, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"imei\", \"==\", trimmedImei));\n            const itemsSnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(qItems);\n            if (itemsSnapshot.empty) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy chi tiết sản phẩm trong đơn h\\xe0ng\"\n                };\n            }\n            const salesOrderItem = itemsSnapshot.docs[0].data();\n            let customerName = \"Kh\\xe1ch lẻ\";\n            let customerPhone = \"\";\n            if (salesOrder.customerId) {\n                const customerRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.CUSTOMERS, salesOrder.customerId);\n                const customerDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(customerRef);\n                if (customerDoc.exists()) {\n                    const customerData = customerDoc.data();\n                    customerName = customerData.name;\n                    customerPhone = customerData.phone;\n                }\n            } else if (salesOrder.customerInfo) {\n                customerName = salesOrder.customerInfo.name;\n                customerPhone = salesOrder.customerInfo.phone;\n            }\n            const returnRequestData = {\n                orderId: salesOrder.id,\n                orderNumber: salesOrder.orderNumber,\n                inventoryItemId: inventoryItem.id,\n                imei: inventoryItem.imei,\n                productId: salesOrderItem.productId,\n                productName: salesOrderItem.productName,\n                variantId: salesOrderItem.variantId,\n                variantSku: salesOrderItem.variantSku,\n                salePrice: salesOrderItem.salePrice,\n                customerId: salesOrder.customerId || \"\",\n                customerName,\n                customerPhone,\n                status: \"pending\",\n                reason,\n                requestedAt: firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.Timestamp.now(),\n                createdBy: userId,\n                updatedBy: userId\n            };\n            const result = await this.create(returnRequestData, userId);\n            return result;\n        } catch (error) {\n            return this.handleError(error);\n        }\n    }\n    async processReturnRequest(returnRequestId, action, userId) {\n        return await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.runTransaction)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, async (transaction)=>{\n            const returnRequestRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.RETURN_REQUESTS, returnRequestId);\n            const returnRequestDoc = await transaction.get(returnRequestRef);\n            if (!returnRequestDoc.exists()) {\n                throw new Error(\"Kh\\xf4ng t\\xecm thấy y\\xeau cầu trả h\\xe0ng.\");\n            }\n            const returnRequest = returnRequestDoc.data();\n            if (returnRequest.status !== \"pending\") {\n                throw new Error(\"Y\\xeau cầu đ\\xe3 được xử l\\xfd.\");\n            }\n            const updateData = {\n                status: action === \"approve\" ? \"approved\" : \"rejected\",\n                processedAt: firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.Timestamp.now(),\n                processedBy: userId,\n                updatedAt: firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.Timestamp.now(),\n                updatedBy: userId\n            };\n            if (action === \"approve\") {\n                // Update inventory item status\n                const inventoryItemRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.INVENTORY, returnRequest.inventoryItemId);\n                const inventoryItemDoc = await transaction.get(inventoryItemRef);\n                if (!inventoryItemDoc.exists() || inventoryItemDoc.data().status !== _constants__WEBPACK_IMPORTED_MODULE_3__.PRODUCT_STATUS.SOLD) {\n                    throw new Error(\"Sản phẩm trong kho kh\\xf4ng hợp lệ hoặc đ\\xe3 được trả lại.\");\n                }\n                transaction.update(inventoryItemRef, {\n                    status: _constants__WEBPACK_IMPORTED_MODULE_3__.PRODUCT_STATUS.IN_STOCK,\n                    salesOrderId: null,\n                    saleDate: null,\n                    actualSalePrice: null,\n                    warrantyStartDate: null,\n                    lastStatusChange: firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.Timestamp.now()\n                });\n                if (returnRequest.customerId) {\n                    const customerHistoryRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.CUSTOMERS, returnRequest.customerId, _constants__WEBPACK_IMPORTED_MODULE_3__.SUBCOLLECTIONS.RETURN_HISTORY));\n                    transaction.set(customerHistoryRef, {\n                        returnRequestId: returnRequestRef.id,\n                        returnedAt: firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.Timestamp.now(),\n                        orderNumber: returnRequest.orderNumber,\n                        productName: returnRequest.productName,\n                        imei: returnRequest.imei,\n                        amount: returnRequest.salePrice\n                    });\n                }\n            }\n            transaction.update(returnRequestRef, updateData);\n            return {\n                success: true\n            };\n        });\n    }\n    async findSoldProductByImei(imei) {\n        try {\n            if (!imei || !imei.trim()) {\n                return {\n                    success: false,\n                    error: \"IMEI kh\\xf4ng được để trống\"\n                };\n            }\n            const trimmedImei = imei.trim();\n            // 1. Find inventory item by IMEI\n            const inventoryRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.INVENTORY);\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)(inventoryRef, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"imei\", \"==\", trimmedImei));\n            const inventorySnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            if (inventorySnapshot.empty) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy sản phẩm với IMEI n\\xe0y\"\n                };\n            }\n            const inventoryItemDoc = inventorySnapshot.docs[0];\n            const inventoryItem = {\n                id: inventoryItemDoc.id,\n                ...inventoryItemDoc.data()\n            };\n            if (inventoryItem.status !== _constants__WEBPACK_IMPORTED_MODULE_3__.PRODUCT_STATUS.SOLD || !inventoryItem.salesOrderId) {\n                return {\n                    success: false,\n                    error: \"Sản phẩm n\\xe0y chưa được b\\xe1n hoặc kh\\xf4ng c\\xf3 th\\xf4ng tin đơn h\\xe0ng\"\n                };\n            }\n            const salesOrderRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.SALES_ORDERS, inventoryItem.salesOrderId);\n            const salesOrderDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(salesOrderRef);\n            if (!salesOrderDoc.exists()) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy đơn h\\xe0ng tương ứng\"\n                };\n            }\n            const salesOrder = {\n                id: salesOrderDoc.id,\n                ...salesOrderDoc.data()\n            };\n            const itemsSubcollectionRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(salesOrderRef, _constants__WEBPACK_IMPORTED_MODULE_3__.SUBCOLLECTIONS.ITEMS);\n            const qItems = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)(itemsSubcollectionRef, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)(\"imei\", \"==\", trimmedImei));\n            const itemsSnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(qItems);\n            if (itemsSnapshot.empty) {\n                return {\n                    success: false,\n                    error: \"Kh\\xf4ng t\\xecm thấy chi tiết sản phẩm trong đơn h\\xe0ng\"\n                };\n            }\n            const salesOrderItem = itemsSnapshot.docs[0].data();\n            let customerName = \"Kh\\xe1ch lẻ\";\n            let customerPhone = \"\";\n            if (salesOrder.customerId) {\n                const customerRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_lib_firebase__WEBPACK_IMPORTED_MODULE_1__.db, _constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.CUSTOMERS, salesOrder.customerId);\n                const customerDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(customerRef);\n                if (customerDoc.exists()) {\n                    const customerData = customerDoc.data();\n                    customerName = customerData.name;\n                    customerPhone = customerData.phone;\n                }\n            } else if (salesOrder.customerInfo) {\n                customerName = salesOrder.customerInfo.name;\n                customerPhone = salesOrder.customerInfo.phone;\n            }\n            return {\n                success: true,\n                data: {\n                    imei: trimmedImei,\n                    orderNumber: salesOrder.orderNumber,\n                    productName: salesOrderItem.productName,\n                    salePrice: salesOrderItem.salePrice,\n                    customerName,\n                    customerPhone\n                }\n            };\n        } catch (error) {\n            return this.handleError(error);\n        }\n    }\n    constructor(){\n        super(_constants__WEBPACK_IMPORTED_MODULE_3__.COLLECTIONS.RETURN_REQUESTS);\n    }\n}\nconst returnsService = new ReturnsService();\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NyYy9saWIvZmlyZWJhc2Uvc2VydmljZXMvcmV0dXJucy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBYTRCO0FBQ1E7QUFDMEI7QUFDWTtBQVMxRSxNQUFNYyx1QkFBdUJKLHNEQUFXQTtJQUt0QyxNQUFNSyxvQkFBdUU7UUFDM0UsSUFBSTtZQUNBLE1BQU1DLElBQUlkLHlEQUFLQSxDQUFDRiw4REFBVUEsQ0FBQ1MsNkNBQUVBLEVBQUUsSUFBSSxDQUFDUSxjQUFjLEdBQUdULDJEQUFPQSxDQUFDLGVBQWU7WUFDNUUsTUFBTVUsV0FBVyxNQUFNZCwyREFBT0EsQ0FBQ1k7WUFDL0IsTUFBTUcsT0FBT0QsU0FBU0UsSUFBSSxDQUFDQyxHQUFHLENBQUNwQixDQUFBQSxNQUFRO29CQUFFcUIsSUFBSXJCLElBQUlxQixFQUFFO29CQUFFLEdBQUdyQixJQUFJa0IsSUFBSSxFQUFFO2dCQUFDO1lBQ25FLE9BQU87Z0JBQUVJLFNBQVM7Z0JBQU1KO1lBQUs7UUFDakMsRUFBRSxPQUFPSyxPQUFPO1lBQ1osT0FBTyxJQUFJLENBQUNDLFdBQVcsQ0FBQ0Q7UUFDNUI7SUFDRjtJQUVBLE1BQU1FLG9CQUNKQyxLQUErQixFQUMvQkMsTUFBYyxFQUNtQztRQUNqRCxJQUFJO1lBQ0YsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLE1BQU0sRUFBRSxHQUFHSDtZQUV6QixJQUFJLENBQUNFLFFBQVEsQ0FBQ0EsS0FBS0UsSUFBSSxJQUFJO2dCQUN6QixPQUFPO29CQUFFUixTQUFTO29CQUFPQyxPQUFPO2dCQUEyQjtZQUM3RDtZQUVBLE1BQU1RLGNBQWNILEtBQUtFLElBQUk7WUFFN0IsaUVBQWlFO1lBQ2pFLE1BQU1FLHNCQUFzQi9CLHlEQUFLQSxDQUMvQkYsOERBQVVBLENBQUNTLDZDQUFFQSxFQUFFRSxtREFBV0EsQ0FBQ3VCLGVBQWUsR0FDMUMvQix5REFBS0EsQ0FBQyxRQUFRLE1BQU02QixjQUNwQjdCLHlEQUFLQSxDQUFD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aEIsZUFBZWdCLFdBQVc7b0JBQ3ZDRyxXQUFXbkIsZUFBZW1CLFNBQVM7b0JBQ25DbEI7b0JBQ0FDO2dCQUNKO1lBQ0o7UUFDRixFQUFFLE9BQU1oQyxPQUFPO1lBQ1gsT0FBTyxJQUFJLENBQUNDLFdBQVcsQ0FBQ0Q7UUFDNUI7SUFDRjtJQTVRQWtGLGFBQWM7UUFDWixLQUFLLENBQUMvRixtREFBV0EsQ0FBQ3VCLGVBQWU7SUFDbkM7QUEyUUY7QUFFTyxNQUFNeUUsaUJBQWlCLElBQUk3RixpQkFBaUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vc3JjL2xpYi9maXJlYmFzZS9zZXJ2aWNlcy9yZXR1cm5zLnNlcnZpY2UudHM/MWIwOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIGNvbGxlY3Rpb24sXHJcbiAgZG9jLFxyXG4gIHF1ZXJ5LFxyXG4gIHdoZXJlLFxyXG4gIGdldERvY3MsXHJcbiAgZ2V0RG9jLFxyXG4gIHdyaXRlQmF0Y2gsXHJcbiAgVGltZXN0YW1wLFxyXG4gIHJ1blRyYW5zYWN0aW9uLFxyXG4gIGFkZERvYyxcclxuICB1cGRhdGVEb2MsXHJcbiAgb3JkZXJCeSxcclxufSBmcm9tIFwiZmlyZWJhc2UvZmlyZXN0b3JlXCI7XHJcbmltcG9ydCB7IGRiIH0gZnJvbSBcIkAvbGliL2ZpcmViYXNlXCI7XHJcbmltcG9ydCB7IEJhc2VTZXJ2aWNlLCBTZXJ2aWNlUmVzcG9uc2UgfSBmcm9tIFwiLi9iYXNlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQ09MTEVDVElPTlMsIFBST0RVQ1RfU1RBVFVTLCBTVUJDT0xMRUNUSU9OUyB9IGZyb20gXCJAL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQge1xyXG4gIEZpcmViYXNlUmV0dXJuUmVxdWVzdCxcclxuICBDcmVhdGVSZXR1cm5SZXF1ZXN0SW5wdXQsXHJcbn0gZnJvbSBcIkAvbGliL2ZpcmViYXNlL21vZGVscy9yZXR1cm5zLm1vZGVsXCI7XHJcbmltcG9ydCB7IEZpcmViYXNlSW52ZW50b3J5SXRlbSB9IGZyb20gXCIuLi9tb2RlbHMvaW52ZW50b3J5Lm1vZGVsXCI7XHJcbmltcG9ydCB7IEZpcmViYXNlU2FsZXNPcmRlciwgRmlyZWJhc2VTYWxlc09yZGVySXRlbSB9IGZyb20gXCIuLi9tb2RlbHMvcG9zLm1vZGVsXCI7XHJcbmltcG9ydCB7IEZpcmViYXNlQ3VzdG9tZXIgfSBmcm9tIFwiLi4vbW9kZWxzL2N1c3RvbWVyLm1vZGVsXCI7XHJcblxyXG5jbGFzcyBSZXR1cm5zU2VydmljZSBleHRlbmRzIEJhc2VTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKENPTExFQ1RJT05TLlJFVFVSTl9SRVFVRVNUUyk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRSZXR1cm5SZXF1ZXN0cygpOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxGaXJlYmFzZVJldHVyblJlcXVlc3RbXT4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KGNvbGxlY3Rpb24oZGIsIHRoaXMuY29sbGVjdGlvbk5hbWUpLCBvcmRlckJ5KFwicmVxdWVzdGVkQXRcIiwgXCJkZXNjXCIpKTtcclxuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0gYXMgRmlyZWJhc2VSZXR1cm5SZXF1ZXN0KSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBjcmVhdGVSZXR1cm5SZXF1ZXN0KFxyXG4gICAgaW5wdXQ6IENyZWF0ZVJldHVyblJlcXVlc3RJbnB1dCxcclxuICAgIHVzZXJJZDogc3RyaW5nXHJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8RmlyZWJhc2VSZXR1cm5SZXF1ZXN0Pj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBpbWVpLCByZWFzb24gfSA9IGlucHV0O1xyXG5cclxuICAgICAgaWYgKCFpbWVpIHx8ICFpbWVpLnRyaW0oKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJTUVJIGtow7RuZyDEkcaw4bujYyDEkeG7gyB0cuG7kW5nXCIgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdHJpbW1lZEltZWkgPSBpbWVpLnRyaW0oKTtcclxuXHJcbiAgICAgIC8vIENoZWNrIGlmIGEgcGVuZGluZyByZXR1cm4gcmVxdWVzdCBmb3IgdGhpcyBJTUVJIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmV0dXJuUXVlcnkgPSBxdWVyeShcclxuICAgICAgICBjb2xsZWN0aW9uKGRiLCBDT0xMRUNUSU9OUy5SRVRVUk5fUkVRVUVTVFMpLFxyXG4gICAgICAgIHdoZXJlKFwiaW1laVwiLCBcIj09XCIsIHRyaW1tZWRJbWVpKSxcclxuICAgICAgICB3aGVyZShcInN0YXR1c1wiLCBcIj09XCIsIFwicGVuZGluZ1wiKVxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCBleGlzdGluZ1JldHVyblNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhleGlzdGluZ1JldHVyblF1ZXJ5KTtcclxuICAgICAgaWYgKCFleGlzdGluZ1JldHVyblNuYXBzaG90LmVtcHR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIsSQw6MgdOG7k24gdOG6oWkgecOqdSBj4bqndSB0cuG6oyBow6BuZyBjaG8gSU1FSSBuw6B5LlwiIH07XHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgICAvLyAxLiBGaW5kIGludmVudG9yeSBpdGVtIGJ5IElNRUlcclxuICAgICAgY29uc3QgaW52ZW50b3J5UmVmID0gY29sbGVjdGlvbihkYiwgQ09MTEVDVElPTlMuSU5WRU5UT1JZKTtcclxuICAgICAgY29uc3QgcSA9IHF1ZXJ5KGludmVudG9yeVJlZiwgd2hlcmUoXCJpbWVpXCIsIFwiPT1cIiwgdHJpbW1lZEltZWkpKTtcclxuICAgICAgY29uc3QgaW52ZW50b3J5U25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xyXG5cclxuICAgICAgaWYgKGludmVudG9yeVNuYXBzaG90LmVtcHR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIktow7RuZyB0w6xtIHRo4bqleSBz4bqjbiBwaOG6qW0gduG7m2kgSU1FSSBuw6B5XCIgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaW52ZW50b3J5SXRlbURvYyA9IGludmVudG9yeVNuYXBzaG90LmRvY3NbMF07XHJcbiAgICAgIGNvbnN0IGludmVudG9yeUl0ZW0gPSB7XHJcbiAgICAgICAgaWQ6IGludmVudG9yeUl0ZW1Eb2MuaWQsXHJcbiAgICAgICAgLi4uaW52ZW50b3J5SXRlbURvYy5kYXRhKCksXHJcbiAgICAgIH0gYXMgRmlyZWJhc2VJbnZlbnRvcnlJdGVtO1xyXG5cclxuICAgICAgaWYgKGludmVudG9yeUl0ZW0uc3RhdHVzICE9PSBQUk9EVUNUX1NUQVRVUy5TT0xEIHx8ICFpbnZlbnRvcnlJdGVtLnNhbGVzT3JkZXJJZCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIlPhuqNuIHBo4bqpbSBuw6B5IGNoxrBhIMSRxrDhu6NjIGLDoW4gaG/hurdjIGtow7RuZyBjw7MgdGjDtG5nIHRpbiDEkcahbiBow6BuZ1wiLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXJSZWYgPSBkb2MoZGIsIENPTExFQ1RJT05TLlNBTEVTX09SREVSUywgaW52ZW50b3J5SXRlbS5zYWxlc09yZGVySWQpO1xyXG4gICAgICBjb25zdCBzYWxlc09yZGVyRG9jID0gYXdhaXQgZ2V0RG9jKHNhbGVzT3JkZXJSZWYpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFzYWxlc09yZGVyRG9jLmV4aXN0cygpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiS2jDtG5nIHTDrG0gdGjhuqV5IMSRxqFuIGjDoG5nIHTGsMahbmcg4bupbmdcIiB9O1xyXG4gICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXIgPSB7IGlkOiBzYWxlc09yZGVyRG9jLmlkLCAuLi5zYWxlc09yZGVyRG9jLmRhdGEoKSB9IGFzIEZpcmViYXNlU2FsZXNPcmRlcjtcclxuICAgICAgICBcclxuICAgICAgY29uc3QgaXRlbXNTdWJjb2xsZWN0aW9uUmVmID0gY29sbGVjdGlvbihzYWxlc09yZGVyUmVmLCBTVUJDT0xMRUNUSU9OUy5JVEVNUyk7XHJcbiAgICAgIGNvbnN0IHFJdGVtcyA9IHF1ZXJ5KGl0ZW1zU3ViY29sbGVjdGlvblJlZiwgd2hlcmUoXCJpbWVpXCIsIFwiPT1cIiwgdHJpbW1lZEltZWkpKTtcclxuICAgICAgY29uc3QgaXRlbXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocUl0ZW1zKTtcclxuXHJcbiAgICAgIGlmIChpdGVtc1NuYXBzaG90LmVtcHR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIktow7RuZyB0w6xtIHRo4bqleSBjaGkgdGnhur90IHPhuqNuIHBo4bqpbSB0cm9uZyDEkcahbiBow6BuZ1wiIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXJJdGVtID0gaXRlbXNTbmFwc2hvdC5kb2NzWzBdLmRhdGEoKSBhcyBGaXJlYmFzZVNhbGVzT3JkZXJJdGVtO1xyXG5cclxuICAgICAgbGV0IGN1c3RvbWVyTmFtZSA9IFwiS2jDoWNoIGzhurtcIjtcclxuICAgICAgbGV0IGN1c3RvbWVyUGhvbmUgPSBcIlwiO1xyXG5cclxuICAgICAgaWYgKHNhbGVzT3JkZXIuY3VzdG9tZXJJZCkge1xyXG4gICAgICAgIGNvbnN0IGN1c3RvbWVyUmVmID0gZG9jKGRiLCBDT0xMRUNUSU9OUy5DVVNUT01FUlMsIHNhbGVzT3JkZXIuY3VzdG9tZXJJZCk7XHJcbiAgICAgICAgY29uc3QgY3VzdG9tZXJEb2MgPSBhd2FpdCBnZXREb2MoY3VzdG9tZXJSZWYpO1xyXG4gICAgICAgIGlmIChjdXN0b21lckRvYy5leGlzdHMoKSkge1xyXG4gICAgICAgICAgY29uc3QgY3VzdG9tZXJEYXRhID0gY3VzdG9tZXJEb2MuZGF0YSgpIGFzIEZpcmViYXNlQ3VzdG9tZXI7XHJcbiAgICAgICAgICBjdXN0b21lck5hbWUgPSBjdXN0b21lckRhdGEubmFtZTtcclxuICAgICAgICAgIGN1c3RvbWVyUGhvbmUgPSBjdXN0b21lckRhdGEucGhvbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHNhbGVzT3JkZXIuY3VzdG9tZXJJbmZvKSB7XHJcbiAgICAgICAgY3VzdG9tZXJOYW1lID0gc2FsZXNPcmRlci5jdXN0b21lckluZm8ubmFtZTtcclxuICAgICAgICBjdXN0b21lclBob25lID0gc2FsZXNPcmRlci5jdXN0b21lckluZm8ucGhvbmU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHJldHVyblJlcXVlc3REYXRhOiBPbWl0PEZpcmViYXNlUmV0dXJuUmVxdWVzdCwgXCJpZFwiIHwgXCJjcmVhdGVkQXRcIiB8IFwidXBkYXRlZEF0XCI+ID0ge1xyXG4gICAgICAgIG9yZGVySWQ6IHNhbGVzT3JkZXIuaWQsXHJcbiAgICAgICAgb3JkZXJOdW1iZXI6IHNhbGVzT3JkZXIub3JkZXJOdW1iZXIsXHJcbiAgICAgICAgaW52ZW50b3J5SXRlbUlkOiBpbnZlbnRvcnlJdGVtLmlkLFxyXG4gICAgICAgIGltZWk6IGludmVudG9yeUl0ZW0uaW1laSxcclxuICAgICAgICBwcm9kdWN0SWQ6IHNhbGVzT3JkZXJJdGVtLnByb2R1Y3RJZCxcclxuICAgICAgICBwcm9kdWN0TmFtZTogc2FsZXNPcmRlckl0ZW0ucHJvZHVjdE5hbWUsXHJcbiAgICAgICAgdmFyaWFudElkOiBzYWxlc09yZGVySXRlbS52YXJpYW50SWQsXHJcbiAgICAgICAgdmFyaWFudFNrdTogc2FsZXNPcmRlckl0ZW0udmFyaWFudFNrdSxcclxuICAgICAgICBzYWxlUHJpY2U6IHNhbGVzT3JkZXJJdGVtLnNhbGVQcmljZSxcclxuICAgICAgICBjdXN0b21lcklkOiBzYWxlc09yZGVyLmN1c3RvbWVySWQgfHwgXCJcIixcclxuICAgICAgICBjdXN0b21lck5hbWUsXHJcbiAgICAgICAgY3VzdG9tZXJQaG9uZSxcclxuICAgICAgICBzdGF0dXM6IFwicGVuZGluZ1wiLFxyXG4gICAgICAgIHJlYXNvbixcclxuICAgICAgICByZXF1ZXN0ZWRBdDogVGltZXN0YW1wLm5vdygpLFxyXG4gICAgICAgIGNyZWF0ZWRCeTogdXNlcklkLFxyXG4gICAgICAgIHVwZGF0ZWRCeTogdXNlcklkLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jcmVhdGUocmV0dXJuUmVxdWVzdERhdGEsIHVzZXJJZCk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0IGFzIFNlcnZpY2VSZXNwb25zZTxGaXJlYmFzZVJldHVyblJlcXVlc3Q+O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcHJvY2Vzc1JldHVyblJlcXVlc3QoXHJcbiAgICByZXR1cm5SZXF1ZXN0SWQ6IHN0cmluZyxcclxuICAgIGFjdGlvbjogXCJhcHByb3ZlXCIgfCBcInJlamVjdFwiLFxyXG4gICAgdXNlcklkOiBzdHJpbmdcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTx2b2lkPj4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5SZXF1ZXN0UmVmID0gZG9jKGRiLCBDT0xMRUNUSU9OUy5SRVRVUk5fUkVRVUVTVFMsIHJldHVyblJlcXVlc3RJZCk7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuUmVxdWVzdERvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChyZXR1cm5SZXF1ZXN0UmVmKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXR1cm5SZXF1ZXN0RG9jLmV4aXN0cygpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIktow7RuZyB0w6xtIHRo4bqleSB5w6p1IGPhuqd1IHRy4bqjIGjDoG5nLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJldHVyblJlcXVlc3QgPSByZXR1cm5SZXF1ZXN0RG9jLmRhdGEoKSBhcyBGaXJlYmFzZVJldHVyblJlcXVlc3Q7XHJcblxyXG4gICAgICAgIGlmIChyZXR1cm5SZXF1ZXN0LnN0YXR1cyAhPT0gJ3BlbmRpbmcnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlnDqnUgY+G6p3UgxJHDoyDEkcaw4bujYyB44butIGzDvS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgICAgICAgc3RhdHVzOiBhY3Rpb24gPT09ICdhcHByb3ZlJyA/ICdhcHByb3ZlZCcgOiAncmVqZWN0ZWQnLFxyXG4gICAgICAgICAgICBwcm9jZXNzZWRBdDogVGltZXN0YW1wLm5vdygpLFxyXG4gICAgICAgICAgICBwcm9jZXNzZWRCeTogdXNlcklkLFxyXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IFRpbWVzdGFtcC5ub3coKSxcclxuICAgICAgICAgICAgdXBkYXRlZEJ5OiB1c2VySWQsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJhcHByb3ZlXCIpIHtcclxuICAgICAgICAgICAgLy8gVXBkYXRlIGludmVudG9yeSBpdGVtIHN0YXR1c1xyXG4gICAgICAgICAgICBjb25zdCBpbnZlbnRvcnlJdGVtUmVmID0gZG9jKGRiLCBDT0xMRUNUSU9OUy5JTlZFTlRPUlksIHJldHVyblJlcXVlc3QuaW52ZW50b3J5SXRlbUlkKTtcclxuICAgICAgICAgICAgY29uc3QgaW52ZW50b3J5SXRlbURvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChpbnZlbnRvcnlJdGVtUmVmKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghaW52ZW50b3J5SXRlbURvYy5leGlzdHMoKSB8fCBpbnZlbnRvcnlJdGVtRG9jLmRhdGEoKS5zdGF0dXMgIT09IFBST0RVQ1RfU1RBVFVTLlNPTEQpIHtcclxuICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJT4bqjbiBwaOG6qW0gdHJvbmcga2hvIGtow7RuZyBo4bujcCBs4buHIGhv4bq3YyDEkcOjIMSRxrDhu6NjIHRy4bqjIGzhuqFpLlwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJhbnNhY3Rpb24udXBkYXRlKGludmVudG9yeUl0ZW1SZWYsIHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogUFJPRFVDVF9TVEFUVVMuSU5fU1RPQ0ssXHJcbiAgICAgICAgICAgICAgICBzYWxlc09yZGVySWQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBzYWxlRGF0ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgIGFjdHVhbFNhbGVQcmljZTogbnVsbCxcclxuICAgICAgICAgICAgICAgIHdhcnJhbnR5U3RhcnREYXRlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgbGFzdFN0YXR1c0NoYW5nZTogVGltZXN0YW1wLm5vdygpLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXR1cm5SZXF1ZXN0LmN1c3RvbWVySWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbWVySGlzdG9yeVJlZiA9IGRvYyhjb2xsZWN0aW9uKGRiLCBDT0xMRUNUSU9OUy5DVVNUT01FUlMsIHJldHVyblJlcXVlc3QuY3VzdG9tZXJJZCwgU1VCQ09MTEVDVElPTlMuUkVUVVJOX0hJU1RPUlkpKTtcclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChjdXN0b21lckhpc3RvcnlSZWYsIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXF1ZXN0SWQ6IHJldHVyblJlcXVlc3RSZWYuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuZWRBdDogVGltZXN0YW1wLm5vdygpLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyTnVtYmVyOiByZXR1cm5SZXF1ZXN0Lm9yZGVyTnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiByZXR1cm5SZXF1ZXN0LnByb2R1Y3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGltZWk6IHJldHVyblJlcXVlc3QuaW1laSxcclxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IHJldHVyblJlcXVlc3Quc2FsZVByaWNlLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdHJhbnNhY3Rpb24udXBkYXRlKHJldHVyblJlcXVlc3RSZWYsIHVwZGF0ZURhdGEpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZmluZFNvbGRQcm9kdWN0QnlJbWVpKGltZWk6IHN0cmluZyk6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPGFueT4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghaW1laSB8fCAhaW1laS50cmltKCkpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSU1FSSBraMO0bmcgxJHGsOG7o2MgxJHhu4MgdHLhu5FuZ1wiIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRyaW1tZWRJbWVpID0gaW1laS50cmltKCk7XHJcblxyXG4gICAgICAvLyAxLiBGaW5kIGludmVudG9yeSBpdGVtIGJ5IElNRUlcclxuICAgICAgY29uc3QgaW52ZW50b3J5UmVmID0gY29sbGVjdGlvbihkYiwgQ09MTEVDVElPTlMuSU5WRU5UT1JZKTtcclxuICAgICAgY29uc3QgcSA9IHF1ZXJ5KGludmVudG9yeVJlZiwgd2hlcmUoXCJpbWVpXCIsIFwiPT1cIiwgdHJpbW1lZEltZWkpKTtcclxuICAgICAgY29uc3QgaW52ZW50b3J5U25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xyXG5cclxuICAgICAgaWYgKGludmVudG9yeVNuYXBzaG90LmVtcHR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIktow7RuZyB0w6xtIHRo4bqleSBz4bqjbiBwaOG6qW0gduG7m2kgSU1FSSBuw6B5XCIgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaW52ZW50b3J5SXRlbURvYyA9IGludmVudG9yeVNuYXBzaG90LmRvY3NbMF07XHJcbiAgICAgIGNvbnN0IGludmVudG9yeUl0ZW0gPSB7XHJcbiAgICAgICAgaWQ6IGludmVudG9yeUl0ZW1Eb2MuaWQsXHJcbiAgICAgICAgLi4uaW52ZW50b3J5SXRlbURvYy5kYXRhKCksXHJcbiAgICAgIH0gYXMgRmlyZWJhc2VJbnZlbnRvcnlJdGVtO1xyXG5cclxuICAgICAgaWYgKGludmVudG9yeUl0ZW0uc3RhdHVzICE9PSBQUk9EVUNUX1NUQVRVUy5TT0xEIHx8ICFpbnZlbnRvcnlJdGVtLnNhbGVzT3JkZXJJZCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIlPhuqNuIHBo4bqpbSBuw6B5IGNoxrBhIMSRxrDhu6NjIGLDoW4gaG/hurdjIGtow7RuZyBjw7MgdGjDtG5nIHRpbiDEkcahbiBow6BuZ1wiLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXJSZWYgPSBkb2MoZGIsIENPTExFQ1RJT05TLlNBTEVTX09SREVSUywgaW52ZW50b3J5SXRlbS5zYWxlc09yZGVySWQpO1xyXG4gICAgICBjb25zdCBzYWxlc09yZGVyRG9jID0gYXdhaXQgZ2V0RG9jKHNhbGVzT3JkZXJSZWYpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFzYWxlc09yZGVyRG9jLmV4aXN0cygpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiS2jDtG5nIHTDrG0gdGjhuqV5IMSRxqFuIGjDoG5nIHTGsMahbmcg4bupbmdcIiB9O1xyXG4gICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXIgPSB7IGlkOiBzYWxlc09yZGVyRG9jLmlkLCAuLi5zYWxlc09yZGVyRG9jLmRhdGEoKSB9IGFzIEZpcmViYXNlU2FsZXNPcmRlcjtcclxuICAgICAgICBcclxuICAgICAgY29uc3QgaXRlbXNTdWJjb2xsZWN0aW9uUmVmID0gY29sbGVjdGlvbihzYWxlc09yZGVyUmVmLCBTVUJDT0xMRUNUSU9OUy5JVEVNUyk7XHJcbiAgICAgIGNvbnN0IHFJdGVtcyA9IHF1ZXJ5KGl0ZW1zU3ViY29sbGVjdGlvblJlZiwgd2hlcmUoXCJpbWVpXCIsIFwiPT1cIiwgdHJpbW1lZEltZWkpKTtcclxuICAgICAgY29uc3QgaXRlbXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocUl0ZW1zKTtcclxuXHJcbiAgICAgIGlmIChpdGVtc1NuYXBzaG90LmVtcHR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIktow7RuZyB0w6xtIHRo4bqleSBjaGkgdGnhur90IHPhuqNuIHBo4bqpbSB0cm9uZyDEkcahbiBow6BuZ1wiIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHNhbGVzT3JkZXJJdGVtID0gaXRlbXNTbmFwc2hvdC5kb2NzWzBdLmRhdGEoKSBhcyBGaXJlYmFzZVNhbGVzT3JkZXJJdGVtO1xyXG5cclxuICAgICAgbGV0IGN1c3RvbWVyTmFtZSA9IFwiS2jDoWNoIGzhurtcIjtcclxuICAgICAgbGV0IGN1c3RvbWVyUGhvbmUgPSBcIlwiO1xyXG5cclxuICAgICAgaWYgKHNhbGVzT3JkZXIuY3VzdG9tZXJJZCkge1xyXG4gICAgICAgIGNvbnN0IGN1c3RvbWVyUmVmID0gZG9jKGRiLCBDT0xMRUNUSU9OUy5DVVNUT01FUlMsIHNhbGVzT3JkZXIuY3VzdG9tZXJJZCk7XHJcbiAgICAgICAgY29uc3QgY3VzdG9tZXJEb2MgPSBhd2FpdCBnZXREb2MoY3VzdG9tZXJSZWYpO1xyXG4gICAgICAgIGlmIChjdXN0b21lckRvYy5leGlzdHMoKSkge1xyXG4gICAgICAgICAgY29uc3QgY3VzdG9tZXJEYXRhID0gY3VzdG9tZXJEb2MuZGF0YSgpIGFzIEZpcmViYXNlQ3VzdG9tZXI7XHJcbiAgICAgICAgICBjdXN0b21lck5hbWUgPSBjdXN0b21lckRhdGEubmFtZTtcclxuICAgICAgICAgIGN1c3RvbWVyUGhvbmUgPSBjdXN0b21lckRhdGEucGhvbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHNhbGVzT3JkZXIuY3VzdG9tZXJJbmZvKSB7XHJcbiAgICAgICAgY3VzdG9tZXJOYW1lID0gc2FsZXNPcmRlci5jdXN0b21lckluZm8ubmFtZTtcclxuICAgICAgICBjdXN0b21lclBob25lID0gc2FsZXNPcmRlci5jdXN0b21lckluZm8ucGhvbmU7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgIGltZWk6IHRyaW1tZWRJbWVpLFxyXG4gICAgICAgICAgICAgIG9yZGVyTnVtYmVyOiBzYWxlc09yZGVyLm9yZGVyTnVtYmVyLFxyXG4gICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiBzYWxlc09yZGVySXRlbS5wcm9kdWN0TmFtZSxcclxuICAgICAgICAgICAgICBzYWxlUHJpY2U6IHNhbGVzT3JkZXJJdGVtLnNhbGVQcmljZSxcclxuICAgICAgICAgICAgICBjdXN0b21lck5hbWUsXHJcbiAgICAgICAgICAgICAgY3VzdG9tZXJQaG9uZSxcclxuICAgICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBjYXRjaChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCByZXR1cm5zU2VydmljZSA9IG5ldyBSZXR1cm5zU2VydmljZSgpOyAiXSwibmFtZXMiOlsiY29sbGVjdGlvbiIsImRvYyIsInF1ZXJ5Iiwid2hlcmUiLCJnZXREb2NzIiwiZ2V0RG9jIiwiVGltZXN0YW1wIiwicnVuVHJhbnNhY3Rpb24iLCJvcmRlckJ5IiwiZGIiLCJCYXNlU2VydmljZSIsIkNPTExFQ1RJT05TIiwiUFJPRFVDVF9TVEFUVVMiLCJTVUJDT0xMRUNUSU9OUyIsIlJldHVybnNTZXJ2aWNlIiwiZ2V0UmV0dXJuUmVxdWVzdHMiLCJxIiwiY29sbGVjdGlvbk5hbWUiLCJzbmFwc2hvdCIsImRhdGEiLCJkb2NzIiwibWFwIiwiaWQiLCJzdWNjZXNzIiwiZXJyb3IiLCJoYW5kbGVFcnJvciIsImNyZWF0ZVJldHVyblJlcXVlc3QiLCJpbnB1dCIsInVzZXJJZCIsImltZWkiLCJyZWFzb24iLCJ0cmltIiwidHJpbW1lZEltZWkiLCJleGlzdGluZ1JldHVyblF1ZXJ5IiwiUkVUVVJOX1JFUVVFU1RTIiwiZXhpc3RpbmdSZXR1cm5TbmFwc2hvdCIsImVtcHR5IiwiaW52ZW50b3J5UmVmIiwiSU5WRU5UT1JZIiwiaW52ZW50b3J5U25hcHNob3QiLCJpbnZlbnRvcnlJdGVtRG9jIiwiaW52ZW50b3J5SXRlbSIsInN0YXR1cyIsIlNPTEQiLCJzYWxlc09yZGVySWQiLCJzYWxlc09yZGVyUmVmIiwiU0FMRVNfT1JERVJTIiwic2FsZXNPcmRlckRvYyIsImV4aXN0cyIsInNhbGVzT3JkZXIiLCJpdGVtc1N1YmNvbGxlY3Rpb25SZWYiLCJJVEVNUyIsInFJdGVtcyIsIml0ZW1zU25hcHNob3QiLCJzYWxlc09yZGVySXRlbSIsImN1c3RvbWVyTmFtZSIsImN1c3RvbWVyUGhvbmUiLCJjdXN0b21lcklkIiwiY3VzdG9tZXJSZWYiLCJDVVNUT01FUlMiLCJjdXN0b21lckRvYyIsImN1c3RvbWVyRGF0YSIsIm5hbWUiLCJwaG9uZSIsImN1c3RvbWVySW5mbyIsInJldHVyblJlcXVlc3REYXRhIiwib3JkZXJJZCIsIm9yZGVyTnVtYmVyIiwiaW52ZW50b3J5SXRlbUlkIiwicHJvZHVjdElkIiwicHJvZHVjdE5hbWUiLCJ2YXJpYW50SWQiLCJ2YXJpYW50U2t1Iiwic2FsZVByaWNlIiwicmVxdWVzdGVkQXQiLCJub3ciLCJjcmVhdGVkQnkiLCJ1cGRhdGVkQnkiLCJyZXN1bHQiLCJjcmVhdGUiLCJwcm9jZXNzUmV0dXJuUmVxdWVzdCIsInJldHVyblJlcXVlc3RJZCIsImFjdGlvbiIsInRyYW5zYWN0aW9uIiwicmV0dXJuUmVxdWVzdFJlZiIsInJldHVyblJlcXVlc3REb2MiLCJnZXQiLCJFcnJvciIsInJldHVyblJlcXVlc3QiLCJ1cGRhdGVEYXRhIiwicHJvY2Vzc2VkQXQiLCJwcm9jZXNzZWRCeSIsInVwZGF0ZWRBdCIsImludmVudG9yeUl0ZW1SZWYiLCJ1cGRhdGUiLCJJTl9TVE9DSyIsInNhbGVEYXRlIiwiYWN0dWFsU2FsZVByaWNlIiwid2FycmFudHlTdGFydERhdGUiLCJsYXN0U3RhdHVzQ2hhbmdlIiwiY3VzdG9tZXJIaXN0b3J5UmVmIiwiUkVUVVJOX0hJU1RPUlkiLCJzZXQiLCJyZXR1cm5lZEF0IiwiYW1vdW50IiwiZmluZFNvbGRQcm9kdWN0QnlJbWVpIiwiY29uc3RydWN0b3IiLCJyZXR1cm5zU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/lib/firebase/services/returns.service.ts\n"));

/***/ })

});