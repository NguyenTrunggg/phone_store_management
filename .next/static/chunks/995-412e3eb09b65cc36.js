"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{9174:function(e,t,a){a.d(t,{C:function(){return i}});var r=a(7437);a(2265);var n=a(535),o=a(3448);let s=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...n}=e;return(0,r.jsx)("div",{className:(0,o.cn)(s({variant:a}),t),...n})}},2381:function(e,t,a){a.d(t,{d:function(){return d},z:function(){return c}});var r=a(7437),n=a(2265),o=a(7053),s=a(535),i=a(3448);let d=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:a,variant:n,size:s,asChild:c=!1,...l}=e,u=c?o.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(d({variant:n,size:s,className:a})),ref:t,...l})});c.displayName="Button"},4291:function(e,t,a){a.d(t,{$N:function(){return h},Be:function(){return y},Vq:function(){return d},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return c}});var r=a(7437),n=a(2265),o=a(9027),s=a(2489),i=a(3448);let d=o.fC,c=o.xz,l=o.h_;o.x8;let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(o.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});u.displayName=o.aV.displayName;let f=n.forwardRef((e,t)=>{let{className:a,children:n,...d}=e;return(0,r.jsxs)(l,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(o.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[n,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=o.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});h.displayName=o.Dx.displayName;let y=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...n})});y.displayName=o.dk.displayName},279:function(e,t,a){a.d(t,{I:function(){return s}});var r=a(7437),n=a(2265),o=a(3448);let s=n.forwardRef((e,t)=>{let{className:a,type:n,...s}=e;return(0,r.jsx)("input",{type:n,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});s.displayName="Input"},5060:function(e,t,a){a.d(t,{_:function(){return c}});var r=a(7437),n=a(2265),o=a(6394),s=a(535),i=a(3448);let d=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(o.f,{ref:t,className:(0,i.cn)(d(),a),...n})});c.displayName=o.f.displayName},4749:function(e,t,a){a.d(t,{C:function(){return d}});var r=a(5978),n=a(6410),o=a(8086),s=a(3976);class i extends o.bQ{async createCustomer(e,t){try{var a,n,o,s;if(e.phone){let t=(0,r.IO)(this.collectionRef,(0,r.ar)("phone","==",e.phone));if(!(await (0,r.PL)(t)).empty)return{success:!1,error:"Số điện thoại đ\xe3 tồn tại.",errorCode:"DUPLICATE_PHONE"}}let i=r.EK.now(),d={name:e.name,phone:e.phone||"",email:e.email||"",addresses:e.address?[{id:"default",type:e.address.type||"home",street:e.address.street,district:e.address.district||"",city:e.address.city,country:e.address.country||"Vietnam",postalCode:e.address.postalCode||"",isDefault:!0,label:e.address.type}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,lastPurchaseDate:r.EK.now(),firstPurchaseDate:r.EK.now(),customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:e.preferredContactMethod||"phone",communicationPreferences:{promotions:null===(a=e.allowMarketing)||void 0===a||a,newProducts:null===(n=e.allowMarketing)||void 0===n||n,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:e.isVip||!1,isCorporate:e.isCorporate||!1,allowMarketing:null===(o=e.allowMarketing)||void 0===o||o,requiresApproval:!1,acquisitionChannel:e.acquisitionChannel||"walk_in",referredBy:null!==(s=e.referredBy)&&void 0!==s?s:"",isActive:!0,isBlacklisted:!1,createdAt:i,updatedAt:i,createdBy:t,updatedBy:t};return await this.create(d,t)}catch(e){return this.handleError(e)}}async searchCustomers(e){try{let{searchTerm:t,limit:a=10,isActive:n=!0}=e;if(!t)return{success:!0,data:{data:[],hasMore:!1}};let o=t+"",s=(0,r.IO)(this.collectionRef,(0,r.ar)("isActive","==",n),(0,r.ar)("name",">=",t),(0,r.ar)("name","<=",o)),i=(0,r.IO)(this.collectionRef,(0,r.ar)("isActive","==",n),(0,r.ar)("phone",">=",t),(0,r.ar)("phone","<=",o)),[d,c]=await Promise.all([(0,r.PL)(s),(0,r.PL)(i)]),l=new Map;d.docs.forEach(e=>{l.has(e.id)||l.set(e.id,{id:e.id,...e.data()})}),c.docs.forEach(e=>{l.has(e.id)||l.set(e.id,{id:e.id,...e.data()})});let u=Array.from(l.values()).sort((e,t)=>e.name.localeCompare(t.name)),f=u.slice(0,a);return{success:!0,data:{data:f,lastDoc:void 0,hasMore:u.length>a}}}catch(e){return this.handleError(e)}}async updateCustomer(e,t,a){try{let r={...t};return await this.update(e,r,a)}catch(e){return this.handleError(e)}}async deleteCustomer(e,t){try{return await this.update(e,{isActive:!1},t),{success:!0}}catch(e){return this.handleError(e)}}async addOrderToCustomer(e,t,a){let o=(0,r.JU)(n.db,s.Ul.CUSTOMERS,t),i=await e.get(o);if(!i.exists())throw Error("Customer with ID ".concat(t," not found."));let d=i.data(),c=(d.totalOrders||0)+1,l=(d.totalSpent||0)+a.totalAmount,u={totalOrders:c,totalSpent:l,averageOrderValue:l/c,lastPurchaseDate:a.orderDate,firstPurchaseDate:d.firstPurchaseDate||a.orderDate};e.update(o,u)}async findCustomerByPhone(e){try{let t=(0,r.IO)(this.collectionRef,(0,r.ar)("phone","==",e),(0,r.b9)(1)),a=await (0,r.PL)(t);if(a.empty)return{success:!0,data:null};let n={id:a.docs[0].id,...a.docs[0].data()};return{success:!0,data:n}}catch(e){return this.handleError(e)}}constructor(){super(s.Ul.CUSTOMERS)}}let d=new i},5151:function(e,t,a){a.d(t,{u:function(){return d}});var r=a(5978),n=a(6410),o=a(8086),s=a(3976);class i extends o.bQ{async getAvailableProductsForSale(){try{let e=(0,r.hJ)(n.db,s.Ul.INVENTORY),t=(0,r.IO)(e,(0,r.ar)("status","in",s.sM)),a=await (0,r.PL)(t);if(a.empty)return{success:!0,data:[]};let o=a.docs.map(e=>({id:e.id,...e.data()})),i=new Map;for(let e of o){if(!e.productId||!e.variantId){console.warn("Inventory item ".concat(e.id," missing productId or variantId, skipping."));continue}let t=i.get(e.productId);t||(t={productId:e.productId,productName:e.productName||"Unknown Product",variants:[]},i.set(e.productId,t));let a=t.variants.find(t=>t.variantId===e.variantId);a||(a={variantId:e.variantId,variantSku:e.variantSku||"Unknown SKU",colorName:e.colorName||"Unknown Color",storageCapacity:e.storageCapacity||"Unknown Storage",availableImeis:[],totalStock:0},t.variants.push(a)),a.availableImeis.push({inventoryItemId:e.id,imei:e.imei,currentRetailPrice:e.currentRetailPrice,entryDate:e.entryDate}),a.totalStock+=1}return{success:!0,data:Array.from(i.values())}}catch(e){return this.handleError(e)}}async createSaleOrder(e,t,a){try{var i,d;let c;let l=e.customerId;if(!l&&(null===(i=e.customerInfo)||void 0===i?void 0:i.phone)&&(null===(d=e.customerInfo)||void 0===d?void 0:d.name)){let t=(0,r.hJ)(n.db,s.Ul.CUSTOMERS),a=(0,r.IO)(t,(0,r.ar)("phone","==",e.customerInfo.phone),(0,r.b9)(1)),o=await (0,r.PL)(a);l=o.empty?(c=(0,r.JU)(t)).id:o.docs[0].id}return await this.runTransaction(async i=>{var d;let u;let f=r.EK.now(),m=(0,r.JU)((0,r.hJ)(n.db,s.Ul.SALES_ORDERS)),p=(0,o.m1)("SO"),h=e.items.map(e=>(0,r.JU)(n.db,s.Ul.INVENTORY,e.inventoryItemId)),y=await Promise.all(h.map(e=>i.get(e)));if(l&&!c){let e=(0,r.JU)(n.db,s.Ul.CUSTOMERS,l);if(!(u=await i.get(e)).exists())throw Error("Kh\xe1ch h\xe0ng với ID ".concat(l," kh\xf4ng t\xecm thấy."))}let g=0,v=[],b=[],I=[];for(let a=0;a<y.length;a++){let r=y[a],n=e.items[a];if(!r.exists())throw Error("Sản phẩm với IMEI ".concat(n.imei," kh\xf4ng t\xecm thấy trong kho."));let o={id:r.id,...r.data()};if(o.imei!==n.imei)throw Error("IMEI kh\xf4ng khớp cho sản phẩm ".concat(n.inventoryItemId,"."));if(o.status!==s.eM.IN_STOCK)throw Error("Sản phẩm ".concat(o.productName," (").concat(n.imei,") kh\xf4ng c\xf2n sẵn."));let i=o.currentRetailPrice;g+=i,v.push({id:"temp-id",salesOrderId:m.id,inventoryItemId:o.id,imei:o.imei,productId:o.productId,variantId:o.variantId,productName:o.productName,variantSku:o.variantSku,colorName:o.colorName,storageCapacity:o.storageCapacity,quantity:1,unitCost:o.entryPrice,salePrice:i,itemDiscountAmount:0,itemTaxAmount:0,finalPrice:i,itemStatus:"fulfilled",entryDateOfItem:o.entryDate,createdAt:f,updatedAt:f,createdBy:t,updatedBy:t}),b.push({ref:h[a],data:{status:s.eM.SOLD,lastStatusChange:f,salesOrderId:m.id,saleDate:f,actualSalePrice:i,warrantyStartDate:f}}),I.push({inventoryItemId:o.id,imei:o.imei,movementType:s.$D.SALE,timestamp:f,quantityChange:-1,previousStatus:s.eM.IN_STOCK,newStatus:s.eM.SOLD,fromLocation:o.currentLocation,toLocation:"Sold",userId:t,userRole:"pos_staff",reason:"B\xe1n h\xe0ng qua POS - Đơn ".concat(p),relatedOrderId:m.id,relatedDocumentType:"sale",createdAt:f,updatedAt:f,createdBy:t,updatedBy:t})}if(c&&(null===(d=e.customerInfo)||void 0===d?void 0:d.name)){let a={name:e.customerInfo.name,phone:e.customerInfo.phone,email:e.customerInfo.email||"",address:{street:e.customerInfo.address||"",city:"TP.HCM",type:"home"},acquisitionChannel:"walk_in"},n={...a,dateOfBirth:r.EK.now(),addresses:a.address?[{id:"default",street:a.address.street,city:a.address.city,country:"Vietnam",isDefault:!0,type:"home"}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:"phone",communicationPreferences:{promotions:!0,newProducts:!0,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:!1,isCorporate:!1,allowMarketing:!0,requiresApproval:!1,isActive:!0,isBlacklisted:!1,createdAt:f,updatedAt:f,createdBy:t,updatedBy:t};i.set(c,n)}let w=e.taxRate||0,x=g*w,S=e.discountAmount||0,E=e.shippingAmount||0,O=g+x-S+E,N={orderNumber:p,orderDate:f,customerInfo:e.customerInfo,subtotalAmount:g,taxRate:w,taxAmount:x,discountAmount:S,shippingAmount:E,totalAmount:O,paymentMethod:e.paymentMethod,paymentStatus:"paid",status:"completed",salesChannel:e.salesChannel||"pos",staffId:t,staffName:a||"",amountReceived:"cash"===e.paymentMethod?e.amountReceived:void 0,changeGiven:"cash"===e.paymentMethod&&e.amountReceived?e.amountReceived-O:void 0,totalItems:e.items.length,totalQuantity:e.items.length,notes:e.notes,createdAt:f,updatedAt:f,createdBy:t,updatedBy:t};if(l&&(N.customerId=l),i.set(m,N),l){let e=(0,r.JU)(n.db,s.Ul.CUSTOMERS,l),t=u?u.data():{totalOrders:0,totalSpent:0,firstPurchaseDate:f},a=(t.totalOrders||0)+1,o=(t.totalSpent||0)+O,d={totalOrders:a,totalSpent:o,averageOrderValue:o/a,lastPurchaseDate:f,firstPurchaseDate:t.firstPurchaseDate||f};i.update(e,d)}for(let e=0;e<v.length;e++){let{id:t,...a}=v[e],o=(0,r.JU)((0,r.hJ)(n.db,m.path,s.N9.ORDER_ITEMS));i.set(o,a),v[e].id=o.id}return b.forEach(e=>i.update(e.ref,e.data)),I.forEach(e=>{let t=(0,r.JU)((0,r.hJ)(n.db,s.Ul.STOCK_MOVEMENTS));i.set(t,e)}),{...N,id:m.id,items:v}})}catch(e){return console.error("Create sale order error:",e),this.handleError(e)}}async getSalesOrderByIdWithItems(e){try{let t=(0,r.JU)(n.db,s.Ul.SALES_ORDERS,e),a=await (0,r.QT)(t);if(!a.exists())return{success:!1,error:"Kh\xf4ng t\xecm thấy đơn h\xe0ng với ID: ".concat(e),errorCode:"ORDER_NOT_FOUND"};let o={id:a.id,...a.data()},i=(0,r.hJ)(n.db,s.Ul.SALES_ORDERS,e,s.N9.ORDER_ITEMS),d=(await (0,r.PL)((0,r.IO)(i,(0,r.Xo)("createdAt","asc")))).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:{order:o,items:d}}}catch(t){return console.error("Error fetching order ".concat(e," with items:"),t),this.handleError(t)}}async getSalesOrdersByCustomerId(e){try{let t=(0,r.hJ)(n.db,s.Ul.SALES_ORDERS),a=(0,r.IO)(t,(0,r.ar)("customerId","==",e),(0,r.Xo)("orderDate","desc")),o=(await (0,r.PL)(a)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:o}}catch(e){return this.handleError(e)}}constructor(){super(s.Ul.SALES_ORDERS)}}let d=new i}}]);