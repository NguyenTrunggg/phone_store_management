(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[386],{2987:function(e,r,t){Promise.resolve().then(t.bind(t,6212))},2208:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},5863:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4630:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},3247:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},8906:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},8930:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2369:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},6212:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return T}});var s=t(7437),a=t(2265),n=t(9820),i=t(2381),o=t(279),l=t(9174),c=t(4291),d=t(5060),u=t(5291),m=t(163),h=t(2369),f=t(8906);let p=(0,t(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var g=t(9397),x=t(3247),v=t(5863),y=t(2208),w=t(4630),j=t(8930),N=t(5091),b=t(5978),k=t(8086),_=t(6410),A=t(3301);class C extends k.bQ{async createUser(e,r){try{var t,s,a,n,i,o;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))return{success:!1,error:"Email kh\xf4ng đ\xfang định dạng",errorCode:"INVALID_EMAIL"};let l=await this.getUserByEmail(e.email);if(l.success&&l.data)return{success:!1,error:"Email đ\xe3 được sử dụng",errorCode:"EMAIL_EXISTS"};let c=await (0,A.Xb)(_.I8,e.email,e.password),d=c.user;await (0,A.ck)(d,{displayName:e.displayName});let u=(null===(t=N.Bv[e.role])||void 0===t?void 0:t.permissions)?[...N.Bv[e.role].permissions]:[],m={email:e.email,displayName:e.displayName,firstName:e.firstName,lastName:e.lastName,phone:e.phone,role:e.role,permissions:u,customPermissions:[],employeeId:c.user.uid,department:null!==(s=e.department)&&void 0!==s?s:"",position:null!==(a=e.position)&&void 0!==a?a:"",assignedStores:e.assignedStores||[],primaryStore:null!==(n=e.primaryStore)&&void 0!==n?n:"",canAccessAllStores:"admin"===e.role,isActive:!0,isEmailVerified:d.emailVerified,isPhoneVerified:!1,mustChangePassword:e.mustChangePassword||!1,totalLogins:0,twoFactorEnabled:!1,preferences:{theme:"light",language:"vi",notifications:{email:!0,sms:!1,push:!0,lowStock:"store_manager"===e.role||"warehouse_staff"===e.role,newOrders:"sales_staff"===e.role||"store_manager"===e.role,returns:"sales_staff"===e.role||"store_manager"===e.role},dashboard:{defaultView:"overview",widgets:this.getDefaultWidgetsByRole(e.role)}},certifications:[],notes:null!==(i=e.notes)&&void 0!==i?i:"",tags:null!==(o=e.tags)&&void 0!==o?o:[],failedLoginAttempts:0,isDeleted:!1};return await this.createWithId(d.uid,m,r)}catch(e){if("auth/email-already-in-use"===e.code)return{success:!1,error:"Email đ\xe3 được sử dụng",errorCode:"EMAIL_EXISTS"};if("auth/weak-password"===e.code)return{success:!1,error:"Mật khẩu qu\xe1 yếu",errorCode:"WEAK_PASSWORD"};return this.handleError(e)}}async createWithId(e,r,t){try{let s=this.addAuditFields(r,t,!1),a=(0,b.JU)(_.db,this.collectionName,e);await (0,b.pl)(a,s);let n=await (0,b.QT)(a);if(!n.exists())return{success:!1,error:"Kh\xf4ng thể tạo mới dữ liệu",errorCode:"CREATE_FAILED"};return{success:!0,data:{id:n.id,...n.data()}}}catch(e){return this.handleError(e)}}async updateUser(e,r,t){try{let a={};if(r.displayName&&(a.displayName=r.displayName),r.firstName&&(a.firstName=r.firstName),r.lastName&&(a.lastName=r.lastName),r.phone&&(a.phone=r.phone),r.profileImageUrl&&(a.profileImageUrl=r.profileImageUrl),r.role){var s;a.role=r.role,a.permissions=(null===(s=N.Bv[r.role])||void 0===s?void 0:s.permissions)?[...N.Bv[r.role].permissions]:[]}return r.customPermissions&&(a.customPermissions=r.customPermissions),r.employeeId&&(a.employeeId=r.employeeId),r.department&&(a.department=r.department),r.position&&(a.position=r.position),r.salary&&(a.salary=r.salary),r.assignedStores&&(a.assignedStores=r.assignedStores),r.primaryStore&&(a.primaryStore=r.primaryStore),void 0!==r.canAccessAllStores&&(a.canAccessAllStores=r.canAccessAllStores),void 0!==r.isActive&&(a.isActive=r.isActive),void 0!==r.mustChangePassword&&(a.mustChangePassword=r.mustChangePassword),r.performance&&a.performance&&(a.performance={...a.performance,...r.performance}),r.notes&&(a.notes=r.notes),r.tags&&(a.tags=r.tags),await this.update(e,a,t)}catch(e){return this.handleError(e)}}async deleteUser(e,r){try{let t=await this.update(e,{isDeleted:!0,isActive:!1},r);if(t.success)return{success:!0};return{success:!1,error:t.error,errorCode:t.errorCode}}catch(e){return this.handleError(e)}}async getUserByEmail(e){try{let r=await this.list({where:[{field:"email",operator:"==",value:e}],limit:1});if(!r.success)return{success:!1,error:r.error,errorCode:r.errorCode};return{success:!0,data:r.data.data.length>0?r.data.data[0]:null}}catch(e){return this.handleError(e)}}async getUserWithComputedFields(e){try{let r=await this.getById(e);if(!r.success||!r.data)return r;let t=r.data,s=N.Bv[t.role],a={...t,roleInfo:{name:(null==s?void 0:s.name)||"Unknown Role",level:(null==s?void 0:s.level)||0,permissions:(null==s?void 0:s.permissions)?[...s.permissions]:[]},allPermissions:(0,N.fi)(t),isOnline:!1,canLogin:t.isActive&&!t.accountLockedUntil,passwordExpired:!1,accountLocked:!!(t.accountLockedUntil&&t.accountLockedUntil.toDate()>new Date)};return{success:!0,data:a}}catch(e){return this.handleError(e)}}async searchUsers(e){try{let r={limit:e.limit||20},t=[];e.role&&e.role.length>0&&t.push({field:"role",operator:"in",value:e.role}),e.department&&e.department.length>0&&t.push({field:"department",operator:"in",value:e.department}),void 0!==e.isActive&&t.push({field:"isActive",operator:"==",value:e.isActive}),e.assignedStores&&e.assignedStores.length>0&&t.push({field:"assignedStores",operator:"array-contains-any",value:e.assignedStores}),e.primaryStore&&t.push({field:"primaryStore",operator:"==",value:e.primaryStore}),void 0!==e.mustChangePassword&&t.push({field:"mustChangePassword",operator:"==",value:e.mustChangePassword}),void 0!==e.isEmailVerified&&t.push({field:"isEmailVerified",operator:"==",value:e.isEmailVerified}),void 0!==e.twoFactorEnabled&&t.push({field:"twoFactorEnabled",operator:"==",value:e.twoFactorEnabled}),e.hiredAfter&&t.push({field:"hireDate",operator:">=",value:b.EK.fromDate(e.hiredAfter)}),e.hiredBefore&&t.push({field:"hireDate",operator:"<=",value:b.EK.fromDate(e.hiredBefore)}),e.lastLoginAfter&&t.push({field:"lastLoginAt",operator:">=",value:b.EK.fromDate(e.lastLoginAfter)}),e.lastLoginBefore&&t.push({field:"lastLoginAt",operator:"<=",value:b.EK.fromDate(e.lastLoginBefore)}),r.where=t,e.sortBy?r.orderBy=[{field:e.sortBy,direction:e.sortOrder||"asc"}]:r.orderBy=[{field:"displayName",direction:"asc"}],e.startAfter&&(r.startAfter=e.startAfter);let s=await this.list(r);if(s.success&&e.searchTerm){let r=e.searchTerm.toLowerCase();s.data.data=s.data.data.filter(e=>e.displayName.toLowerCase().includes(r)||e.email.toLowerCase().includes(r)||e.employeeId&&e.employeeId.toLowerCase().includes(r))}return s}catch(e){return this.handleError(e)}}async getUsersByRole(e){try{let r=await this.list({where:[{field:"role",operator:"==",value:e},{field:"isActive",operator:"==",value:!0}],orderBy:[{field:"displayName",direction:"asc"}]});if(!r.success)return{success:!1,error:r.error,errorCode:r.errorCode};return{success:!0,data:r.data.data}}catch(e){return this.handleError(e)}}async updateUserLogin(e,r){try{let t={lastLoginAt:r.lastLoginAt,lastLoginIP:r.lastLoginIP,lastLoginDevice:r.lastLoginDevice,totalLogins:(0,b.nP)(1),failedLoginAttempts:0};return await this.update(e,t,e)}catch(e){return this.handleError(e)}}checkUserPermission(e,r,t){if(!(0,N.Fs)(e,r))return{hasPermission:!1,reason:"Insufficient permissions"};let s=(0,N.av)(e,r.split(".")[0],r.split(".")[1],t);return{hasPermission:s.hasPermission,reason:s.reason}}getDefaultWidgetsByRole(e){switch(e){case"admin":return["revenue_overview","sales_summary","inventory_alerts","user_activity","system_health"];case"store_manager":return["revenue_overview","sales_summary","inventory_alerts","staff_performance","customer_analytics"];case"sales_staff":return["daily_sales","my_performance","customer_list","product_catalog"];case"warehouse_staff":return["inventory_summary","stock_movements","low_stock_alerts","recent_shipments"];default:return["overview"]}}constructor(){super("users")}}let E=new C;var S=t(4438);let I="mock-admin-user-id";function T(){var e,r,t,b,k,_;let[A,C]=(0,a.useState)([]),[T,R]=(0,a.useState)(!0),[L,D]=(0,a.useState)(""),[P]=(r=(0,a.useRef)(L),t=(0,a.useState)({})[1],b=function(e,r,t){var s=this,n=(0,a.useRef)(null),i=(0,a.useRef)(0),o=(0,a.useRef)(null),l=(0,a.useRef)([]),c=(0,a.useRef)(),d=(0,a.useRef)(),u=(0,a.useRef)(e),m=(0,a.useRef)(!0);u.current=e;var h="undefined"!=typeof window,f=!r&&0!==r&&h;if("function"!=typeof e)throw TypeError("Expected a function");r=+r||0;var p=!!(t=t||{}).leading,g=!("trailing"in t)||!!t.trailing,x="maxWait"in t,v="debounceOnServer"in t&&!!t.debounceOnServer,y=x?Math.max(+t.maxWait||0,r):null;return(0,a.useEffect)(function(){return m.current=!0,function(){m.current=!1}},[]),(0,a.useMemo)(function(){var e=function(e){var r=l.current,t=c.current;return l.current=c.current=null,i.current=e,d.current=u.current.apply(t,r)},t=function(e,r){f&&cancelAnimationFrame(o.current),o.current=f?requestAnimationFrame(e):setTimeout(e,r)},a=function(e){if(!m.current)return!1;var t=e-n.current;return!n.current||t>=r||t<0||x&&e-i.current>=y},w=function(r){return o.current=null,g&&l.current?e(r):(l.current=c.current=null,d.current)},j=function e(){var s=Date.now();if(a(s))return w(s);if(m.current){var o=r-(s-n.current);t(e,x?Math.min(o,y-(s-i.current)):o)}},N=function(){if(h||v){var u=Date.now(),f=a(u);if(l.current=[].slice.call(arguments),c.current=s,n.current=u,f){if(!o.current&&m.current)return i.current=n.current,t(j,r),p?e(n.current):d.current;if(x)return t(j,r),e(n.current)}return o.current||t(j,r),d.current}};return N.cancel=function(){o.current&&(f?cancelAnimationFrame(o.current):clearTimeout(o.current)),i.current=0,l.current=n.current=c.current=o.current=null},N.isPending=function(){return!!o.current},N.flush=function(){return o.current?w(Date.now()):d.current},N},[p,x,r,y,g,f,h,v])}((0,a.useCallback)(function(e){r.current=e,t({})},[t]),300,e),_=(k=(0,a.useRef)(L)).current,_===L||(b(L),k.current=L),[r.current,b]),[Z,B]=(0,a.useState)(!1),[O,V]=(0,a.useState)(!1),[U,F]=(0,a.useState)(null),[z,M]=(0,a.useState)({role:"sales_staff",displayName:"",email:"",password:"",phone:"",firstName:"",lastName:""}),[K,Q]=(0,a.useState)({}),[X,q]=(0,a.useState)(""),W=async()=>{R(!0);let e=await E.searchUsers({searchTerm:P,sortBy:"displayName",sortOrder:"asc"});e.success&&e.data?C(e.data.data.filter(e=>!e.isDeleted)):S.Am.error("Lỗi",{description:e.error||"Kh\xf4ng thể tải danh s\xe1ch người d\xf9ng."}),R(!1)};(0,a.useEffect)(()=>{W()},[P]);let H=async()=>{if(z.password!==X){S.Am.error("Lỗi",{description:"Mật khẩu kh\xf4ng khớp."});return}if(!z.email||!z.password||!z.displayName){S.Am.error("Lỗi",{description:"Vui l\xf2ng điền c\xe1c trường bắt buộc."});return}let e=await E.createUser(z,I);e.success?(S.Am.success("Th\xe0nh c\xf4ng",{description:"Người d\xf9ng đ\xe3 được tạo th\xe0nh c\xf4ng."}),B(!1),M({role:"sales_staff",displayName:"",email:"",password:"",phone:"",firstName:"",lastName:""}),q(""),W()):S.Am.error("Lỗi",{description:e.error||"Kh\xf4ng thể tạo người d\xf9ng."})},Y=async()=>{if(!U)return;let e=await E.updateUser(U.id,K,I);e.success?(S.Am.success("Th\xe0nh c\xf4ng",{description:"Th\xf4ng tin người d\xf9ng đ\xe3 được cập nhật."}),V(!1),F(null),Q({}),W()):S.Am.error("Lỗi",{description:e.error||"Kh\xf4ng thể cập nhật người d\xf9ng."})},J=async e=>{let r=await E.updateUser(e.id,{isActive:!e.isActive},I);r.success?(S.Am.success("Th\xe0nh c\xf4ng",{description:"Người d\xf9ng đ\xe3 được ".concat(e.isActive?"v\xf4 hiệu h\xf3a":"k\xedch hoạt",".")}),W()):S.Am.error("Lỗi",{description:r.error||"Kh\xf4ng thể thay đổi trạng th\xe1i người d\xf9ng."})},$=e=>{S.Am.warning("Bạn c\xf3 chắc muốn x\xf3a người d\xf9ng ".concat(e.displayName,"?"),{action:{label:"X\xf3a",onClick:async()=>{let r=await E.deleteUser(e.id,I);r.success?(S.Am.success("Th\xe0nh c\xf4ng",{description:"Người d\xf9ng đ\xe3 được x\xf3a."}),W()):S.Am.error("Lỗi",{description:r.error||"Kh\xf4ng thể x\xf3a người d\xf9ng."})}},duration:5e3})},G=e=>{let r=N.Bv[e],t=(0,s.jsx)(h.Z,{className:"w-3 h-3 mr-1"}),a="bg-green-100 text-green-800";return"admin"===e?(t=(0,s.jsx)(f.Z,{className:"w-3 h-3 mr-1"}),a="bg-red-100 text-red-800"):"store_manager"===e&&(t=(0,s.jsx)(p,{className:"w-3 h-3 mr-1"}),a="bg-blue-100 text-blue-800"),(0,s.jsxs)(l.C,{className:a,children:[t,(null==r?void 0:r.name)||e]})},ee=e=>e?new Date(1e3*e.seconds).toLocaleString("vi-VN"):"Chưa đăng nhập",er=(0,a.useMemo)(()=>({total:A.length,active:A.filter(e=>e.isActive).length,admin:A.filter(e=>"admin"===e.role).length,store_manager:A.filter(e=>"store_manager"===e.role).length,sales_staff:A.filter(e=>"sales_staff"===e.role).length,warehouse_staff:A.filter(e=>"warehouse_staff"===e.role).length}),[A]);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Quản l\xfd người d\xf9ng"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Quản l\xfd t\xe0i khoản v\xe0 ph\xe2n quyền hệ thống"})]}),(0,s.jsxs)(c.Vq,{open:Z,onOpenChange:B,children:[(0,s.jsx)(c.hg,{asChild:!0,children:(0,s.jsxs)(i.z,{children:[(0,s.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"Th\xeam người d\xf9ng"]})}),(0,s.jsxs)(c.cZ,{className:"sm:max-w-[600px]",children:[(0,s.jsxs)(c.fK,{children:[(0,s.jsx)(c.$N,{children:"Th\xeam người d\xf9ng mới"}),(0,s.jsx)(c.Be,{children:"Tạo t\xe0i khoản mới cho nh\xe2n vi\xean"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"displayName",children:"Họ v\xe0 t\xean"}),(0,s.jsx)(o.I,{id:"displayName",value:z.displayName,onChange:e=>M({...z,displayName:e.target.value}),placeholder:"Nguyễn Văn A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"email",children:"Email"}),(0,s.jsx)(o.I,{id:"email",type:"email",value:z.email,onChange:e=>M({...z,email:e.target.value}),placeholder:"user@email.com"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"firstName",children:"T\xean"}),(0,s.jsx)(o.I,{id:"firstName",value:z.firstName,onChange:e=>M({...z,firstName:e.target.value}),placeholder:"An"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"lastName",children:"Họ"}),(0,s.jsx)(o.I,{id:"lastName",value:z.lastName,onChange:e=>M({...z,lastName:e.target.value}),placeholder:"Nguyễn Văn"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"phone",children:"Số điện thoại"}),(0,s.jsx)(o.I,{id:"phone",value:z.phone,onChange:e=>M({...z,phone:e.target.value}),placeholder:"09XXXXXXXX"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"role",children:"Vai tr\xf2"}),(0,s.jsxs)(u.Ph,{value:z.role,onValueChange:e=>M({...z,role:e}),children:[(0,s.jsx)(u.i4,{children:(0,s.jsx)(u.ki,{})}),(0,s.jsx)(u.Bw,{children:Object.entries(N.Bv).map(e=>{let[r,t]=e;return(0,s.jsx)(u.Ql,{value:r,children:t.name},r)})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"password",children:"Mật khẩu"}),(0,s.jsx)(o.I,{id:"password",type:"password",value:z.password,onChange:e=>M({...z,password:e.target.value}),placeholder:"••••••••"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"confirmPassword",children:"X\xe1c nhận mật khẩu"}),(0,s.jsx)(o.I,{id:"confirmPassword",type:"password",value:X,onChange:e=>q(e.target.value),placeholder:"••••••••"})]})]})]}),(0,s.jsxs)(c.cN,{children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>B(!1),children:"Hủy"}),(0,s.jsx)(i.z,{onClick:H,children:"Tạo t\xe0i khoản"})]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(n.ll,{className:"text-sm font-medium",children:"Tổng người d\xf9ng"}),(0,s.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(n.aY,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:er.total}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[er.active," đang hoạt động"]})]})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(n.ll,{className:"text-sm font-medium",children:"Quản trị vi\xean"}),(0,s.jsx)(f.Z,{className:"h-4 w-4 text-red-500"})]}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:er.admin})})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(n.ll,{className:"text-sm font-medium",children:"Quản l\xfd"}),(0,s.jsx)(p,{className:"h-4 w-4 text-blue-500"})]}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:er.store_manager})})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(n.ll,{className:"text-sm font-medium",children:"Nh\xe2n vi\xean"}),(0,s.jsx)(h.Z,{className:"h-4 w-4 text-green-500"})]}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:er.sales_staff+er.warehouse_staff})})]})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(n.ll,{children:"Danh s\xe1ch người d\xf9ng"}),(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)(x.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,s.jsx)(o.I,{placeholder:"T\xecm theo t\xean, email...",value:L,onChange:e=>D(e.target.value),className:"pl-10"})]})]})}),(0,s.jsx)(n.aY,{children:T?(0,s.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,s.jsx)(v.Z,{className:"w-8 h-8 animate-spin text-primary"})}):(0,s.jsx)("div",{className:"space-y-4",children:A.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(h.Z,{className:"w-6 h-6 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.displayName}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.email}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Đăng nhập cuối: ",ee(e.lastLoginAt)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[G(e.role),(0,s.jsx)(l.C,{variant:e.isActive?"default":"secondary",children:e.isActive?"Hoạt động":"Tạm kh\xf3a"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.r,{checked:e.isActive,onCheckedChange:()=>J(e),id:"status-switch-".concat(e.id)}),(0,s.jsx)(d._,{htmlFor:"status-switch-".concat(e.id),className:"text-sm text-gray-600",children:e.isActive?"Hoạt động":"Tạm kh\xf3a"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(i.z,{variant:"outline",size:"sm",children:[(0,s.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"Xem"]}),(0,s.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{F(e),Q({displayName:e.displayName,firstName:e.firstName,lastName:e.lastName,phone:e.phone,role:e.role}),V(!0)},children:[(0,s.jsx)(w.Z,{className:"w-4 h-4 mr-1"}),"Sửa"]}),(0,s.jsxs)(i.z,{variant:"outline",size:"sm",className:"text-red-500 hover:text-red-700",onClick:()=>$(e),children:[(0,s.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),"X\xf3a"]})]})]})]},e.id))})})]}),(0,s.jsx)(c.Vq,{open:O,onOpenChange:V,children:(0,s.jsxs)(c.cZ,{className:"sm:max-w-[600px]",children:[(0,s.jsxs)(c.fK,{children:[(0,s.jsx)(c.$N,{children:"Chỉnh sửa người d\xf9ng"}),(0,s.jsxs)(c.Be,{children:["Cập nhật th\xf4ng tin cho ",null==U?void 0:U.displayName]})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Họ v\xe0 t\xean"}),(0,s.jsx)(o.I,{value:K.displayName,onChange:e=>Q({...K,displayName:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Số điện thoại"}),(0,s.jsx)(o.I,{value:K.phone,onChange:e=>Q({...K,phone:e.target.value})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Vai tr\xf2"}),(0,s.jsxs)(u.Ph,{value:K.role,onValueChange:e=>Q({...K,role:e}),children:[(0,s.jsx)(u.i4,{children:(0,s.jsx)(u.ki,{})}),(0,s.jsx)(u.Bw,{children:Object.entries(N.Bv).map(e=>{let[r,t]=e;return(0,s.jsx)(u.Ql,{value:r,children:t.name},r)})})]})]})]}),(0,s.jsxs)(c.cN,{children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>V(!1),children:"Hủy"}),(0,s.jsx)(i.z,{onClick:Y,children:"Lưu thay đổi"})]})]})})]})}},9174:function(e,r,t){"use strict";t.d(r,{C:function(){return o}});var s=t(7437);t(2265);var a=t(535),n=t(3448);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:t}),r),...a})}},2381:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return c}});var s=t(7437),a=t(2265),n=t(7053),i=t(535),o=t(3448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,r)=>{let{className:t,variant:a,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,o.cn)(l({variant:a,size:i,className:t})),ref:r,...d})});c.displayName="Button"},9820:function(e,r,t){"use strict";t.d(r,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var s=t(7437),a=t(2265),n=t(3448);let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});i.displayName="Card";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});o.displayName="CardHeader";let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...a})});d.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},4291:function(e,r,t){"use strict";t.d(r,{$N:function(){return p},Be:function(){return g},Vq:function(){return l},cN:function(){return f},cZ:function(){return m},fK:function(){return h},hg:function(){return c}});var s=t(7437),a=t(2265),n=t(9027),i=t(2489),o=t(3448);let l=n.fC,c=n.xz,d=n.h_;n.x8;let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.aV,{ref:r,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a})});u.displayName=n.aV.displayName;let m=a.forwardRef((e,r)=>{let{className:t,children:a,...l}=e;return(0,s.jsxs)(d,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(n.VY,{ref:r,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[a,(0,s.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.VY.displayName;let h=e=>{let{className:r,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...t})};h.displayName="DialogHeader";let f=e=>{let{className:r,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};f.displayName="DialogFooter";let p=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.Dx,{ref:r,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...a})});p.displayName=n.Dx.displayName;let g=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.dk,{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",t),...a})});g.displayName=n.dk.displayName},279:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),a=t(2265),n=t(3448);let i=a.forwardRef((e,r)=>{let{className:t,type:a,...i}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...i})});i.displayName="Input"},5060:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var s=t(7437),a=t(2265),n=t(6394),i=t(535),o=t(3448);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.f,{ref:r,className:(0,o.cn)(l(),t),...a})});c.displayName=n.f.displayName},5291:function(e,r,t){"use strict";t.d(r,{Bw:function(){return p},Ph:function(){return d},Ql:function(){return g},i4:function(){return m},ki:function(){return u}});var s=t(7437),a=t(2265),n=t(3911),i=t(875),o=t(2135),l=t(401),c=t(3448);let d=n.fC;n.ZA;let u=n.B4,m=a.forwardRef((e,r)=>{let{className:t,children:a,...o}=e;return(0,s.jsxs)(n.xz,{ref:r,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...o,children:[a,(0,s.jsx)(n.JO,{asChild:!0,children:(0,s.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.xz.displayName;let h=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.u_,{ref:r,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})});h.displayName=n.u_.displayName;let f=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.$G,{ref:r,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=n.$G.displayName;let p=a.forwardRef((e,r)=>{let{className:t,children:a,position:i="popper",...o}=e;return(0,s.jsx)(n.h_,{children:(0,s.jsxs)(n.VY,{ref:r,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...o,children:[(0,s.jsx)(h,{}),(0,s.jsx)(n.l_,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,s.jsx)(f,{})]})})});p.displayName=n.VY.displayName,a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.__,{ref:r,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...a})}).displayName=n.__.displayName;let g=a.forwardRef((e,r)=>{let{className:t,children:a,...i}=e;return(0,s.jsxs)(n.ck,{ref:r,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(n.wU,{children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(n.eT,{children:a})]})});g.displayName=n.ck.displayName,a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.Z0,{ref:r,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...a})}).displayName=n.Z0.displayName},163:function(e,r,t){"use strict";t.d(r,{r:function(){return b}});var s=t(7437),a=t(2265),n=t(6741),i=t(8575),o=t(3966),l=t(886),c=t(6718),d=t(420),u=t(6840),m="Switch",[h,f]=(0,o.b)(m),[p,g]=h(m),x=a.forwardRef((e,r)=>{let{__scopeSwitch:t,name:o,checked:c,defaultChecked:d,required:m,disabled:h,value:f="on",onCheckedChange:g,form:x,...v}=e,[y,N]=a.useState(null),b=(0,i.e)(r,e=>N(e)),k=a.useRef(!1),_=!y||x||!!y.closest("form"),[A=!1,C]=(0,l.T)({prop:c,defaultProp:d,onChange:g});return(0,s.jsxs)(p,{scope:t,checked:A,disabled:h,children:[(0,s.jsx)(u.WV.button,{type:"button",role:"switch","aria-checked":A,"aria-required":m,"data-state":j(A),"data-disabled":h?"":void 0,disabled:h,value:f,...v,ref:b,onClick:(0,n.M)(e.onClick,e=>{C(e=>!e),_&&(k.current=e.isPropagationStopped(),k.current||e.stopPropagation())})}),_&&(0,s.jsx)(w,{control:y,bubbles:!k.current,name:o,value:f,checked:A,required:m,disabled:h,form:x,style:{transform:"translateX(-100%)"}})]})});x.displayName=m;var v="SwitchThumb",y=a.forwardRef((e,r)=>{let{__scopeSwitch:t,...a}=e,n=g(v,t);return(0,s.jsx)(u.WV.span,{"data-state":j(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:r})});y.displayName=v;var w=e=>{let{control:r,checked:t,bubbles:n=!0,...i}=e,o=a.useRef(null),l=(0,c.D)(t),u=(0,d.t)(r);return a.useEffect(()=>{let e=o.current,r=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(l!==t&&r){let s=new Event("click",{bubbles:n});r.call(e,t),e.dispatchEvent(s)}},[l,t,n]),(0,s.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:o,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function j(e){return e?"checked":"unchecked"}var N=t(3448);let b=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(x,{className:(0,N.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...a,ref:r,children:(0,s.jsx)(y,{className:(0,N.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});b.displayName=x.displayName},6410:function(e,r,t){"use strict";t.d(r,{I8:function(){return c},db:function(){return d}});var s=t(738),a=t(3301),n=t(5978),i=t(62);let o={apiKey:"AIzaSyBPy7aOXz5I8cjrVMxzyDSD-DUM4n4622I",authDomain:"phone-store-management-2025.firebaseapp.com",projectId:"phone-store-management-2025",storageBucket:"phone-store-management-2025.appspot.com",messagingSenderId:"796918304116",appId:"1:796918304116:web:537c49dd91cc9bbdba3021"},l=(0,s.C6)().length?(0,s.Mq)():(0,s.ZF)(o),c=(0,a.v0)(l),d=(0,n.ad)(l);(0,i.cF)(l),o.projectId,o.authDomain,o.storageBucket},5091:function(e,r,t){"use strict";t.d(r,{Bv:function(){return s},Fs:function(){return a},av:function(){return n},fi:function(){return i}});let s={admin:{name:"Administrator",level:100,permissions:["system.*","users.*","roles.*","permissions.*","stores.*","settings.*","audit.*","inventory.*","sales.*","customers.*","suppliers.*","reports.*","returns.*","warranty.*"]},store_manager:{name:"Store Manager",level:80,permissions:["users.read","users.update","users.create","inventory.read","inventory.create","inventory.update","inventory.delete","inventory.adjust","inventory.transfer","sales.read","sales.create","sales.update","sales.process_returns","sales.apply_discounts","sales.override_prices","customers.read","customers.create","customers.update","customers.delete","reports.read","reports.create","reports.export","analytics.read","suppliers.read","suppliers.create","suppliers.update","settings.read","settings.update"]},sales_staff:{name:"Sales Staff",level:50,permissions:["sales.read","sales.create","sales.update_own","sales.process_simple_returns","inventory.read","inventory.check_availability","inventory.reserve","customers.read","customers.create","customers.update","reports.read_own","reports.daily_summary","products.read","warranty.check","users.read_own","users.update_own"]},warehouse_staff:{name:"Warehouse Staff",level:40,permissions:["inventory.read","inventory.create","inventory.update","inventory.receive","inventory.move","inventory.count","inventory.adjust","products.read","products.create","products.update","suppliers.read","purchase_orders.read","purchase_orders.receive","sales.read","sales.process_returns","reports.inventory","reports.stock_movements","users.read_own","users.update_own"]},viewer:{name:"Viewer",level:10,permissions:["products.read","inventory.read","sales.read","customers.read","reports.read","users.read_own","warranty.check"]}};function a(e,r){var t,s;if("admin"===e.role||e.permissions.includes(r)||(null===(t=e.customPermissions)||void 0===t?void 0:t.includes(r)))return!0;let a=r.split(".");for(let r=a.length-1;r>=0;r--){let t=a.slice(0,r).join(".")+".*";if(e.permissions.includes(t)||(null===(s=e.customPermissions)||void 0===s?void 0:s.includes(t)))return!0}return!1}function n(e,r,t,s){let n="".concat(r,".").concat(t);return a(e,n)?n.endsWith("_own")&&s&&(s.userId||s.createdBy||s.staffId)!==e.id?{hasPermission:!1,reason:"Can only access own resources"}:{hasPermission:!0}:{hasPermission:!1,reason:"Insufficient permissions",requiredPermissions:[n]}}function i(e){var r;return Array.from(new Set([...(null===(r=s[e.role])||void 0===r?void 0:r.permissions)||[],...e.customPermissions||[]]))}},8086:function(e,r,t){"use strict";t.d(r,{Ds:function(){return d},bQ:function(){return n},eJ:function(){return i},m1:function(){return o},p6:function(){return c},xG:function(){return l}});var s=t(5978),a=t(6410);class n{handleError(e){if(console.error("".concat(this.collectionName," service error:"),e),e instanceof s.WA)switch(e.code){case"permission-denied":return{success:!1,error:"Bạn kh\xf4ng c\xf3 quyền thực hiện thao t\xe1c n\xe0y",errorCode:"PERMISSION_DENIED"};case"not-found":return{success:!1,error:"Kh\xf4ng t\xecm thấy dữ liệu y\xeau cầu",errorCode:"NOT_FOUND"};case"unavailable":return{success:!1,error:"Dịch vụ tạm thời kh\xf4ng khả dụng, vui l\xf2ng thử lại",errorCode:"UNAVAILABLE"};case"deadline-exceeded":return{success:!1,error:"Thao t\xe1c qu\xe1 thời gian chờ, vui l\xf2ng thử lại",errorCode:"TIMEOUT"};default:return{success:!1,error:"Lỗi hệ thống: ".concat(e.message),errorCode:e.code.toUpperCase()}}return{success:!1,error:"Đ\xe3 xảy ra lỗi kh\xf4ng x\xe1c định",errorCode:"UNKNOWN_ERROR"}}buildQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[];return e.where&&e.where.forEach(e=>{r.push((0,s.ar)(e.field,e.operator,e.value))}),e.orderBy&&e.orderBy.forEach(e=>{r.push((0,s.Xo)(e.field,e.direction))}),e.startAfter&&r.push((0,s.TQ)(e.startAfter)),e.limit&&r.push((0,s.b9)(e.limit)),(0,s.IO)(this.collectionRef,...r)}addAuditFields(e,r){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=s.EK.now(),n={updatedAt:a};return r&&(n.updatedBy=r),!t&&(n.createdAt=a,r&&(n.createdBy=r)),{...e,...n}}documentToObject(e){return{id:e.id,...e.data()}}async create(e,r){try{let t=this.addAuditFields(e,r,!1),a=await (0,s.ET)(this.collectionRef,t),n=await (0,s.QT)(a);if(!n.exists())return{success:!1,error:"Kh\xf4ng thể tạo mới dữ liệu",errorCode:"CREATE_FAILED"};return{success:!0,data:this.documentToObject(n)}}catch(e){return this.handleError(e)}}async getById(e){try{let r=(0,s.JU)(this.collectionRef,e),t=await (0,s.QT)(r);if(!t.exists())return{success:!1,error:"Kh\xf4ng t\xecm thấy dữ liệu",errorCode:"NOT_FOUND"};return{success:!0,data:this.documentToObject(t)}}catch(e){return this.handleError(e)}}async update(e,r,t){try{let a=(0,s.JU)(this.collectionRef,e),n=this.addAuditFields(r,t,!0);await (0,s.r7)(a,n);let i=await (0,s.QT)(a);if(!i.exists())return{success:!1,error:"Kh\xf4ng thể cập nhật dữ liệu",errorCode:"UPDATE_FAILED"};return{success:!0,data:this.documentToObject(i)}}catch(e){return this.handleError(e)}}async delete(e,r){try{let t=(0,s.JU)(this.collectionRef,e);try{return await (0,s.r7)(t,{isDeleted:!0,deletedAt:s.EK.now(),deletedBy:r,updatedAt:s.EK.now(),updatedBy:r}),{success:!0}}catch(e){return await (0,s.oe)(t),{success:!0}}}catch(e){return this.handleError(e)}}async list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let r=this.buildQuery(e),t=await (0,s.PL)(r),a=t.docs.map(e=>this.documentToObject(e)),n=t.docs[t.docs.length-1],i=t.docs.length===(e.limit||a.length);return{success:!0,data:{data:a,lastDoc:n,hasMore:i}}}catch(e){return this.handleError(e)}}async search(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let a=r.map(async r=>{let a=(0,s.IO)(this.collectionRef,(0,s.ar)(r,">=",e),(0,s.ar)(r,"<=",e+""),...t.limit?[(0,s.b9)(t.limit)]:[]);return(await (0,s.PL)(a)).docs.map(e=>this.documentToObject(e))}),n=(await Promise.all(a)).flat().filter((e,r,t)=>r===t.findIndex(r=>r.id===e.id));return{success:!0,data:n}}catch(e){return this.handleError(e)}}async batchCreate(e,r){try{let t=(0,s.qs)(a.db),n=[];e.forEach(e=>{let a=(0,s.JU)(this.collectionRef),i=this.addAuditFields(e,r,!1);t.set(a,i),n.push(a)}),await t.commit();let i=await Promise.all(n.map(async e=>{let r=await (0,s.QT)(e);return this.documentToObject(r)}));return{success:!0,data:i}}catch(e){return this.handleError(e)}}async runTransaction(e){try{let r=await (0,s.i3)(a.db,e);return{success:!0,data:r}}catch(e){return this.handleError(e)}}async exists(e){try{let r=(0,s.JU)(this.collectionRef,e),t=await (0,s.QT)(r);return{success:!0,data:t.exists()}}catch(e){return this.handleError(e)}}async count(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let r=this.buildQuery(e),t=await (0,s.PL)(r);return{success:!0,data:t.size}}catch(e){return this.handleError(e)}}constructor(e){this.collectionName=e,this.collectionRef=(0,s.hJ)(a.db,e)}}let i=e=>/^\d{15}$/.test(e),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SO",r=new Date,t=r.toISOString().slice(0,10).replace(/-/g,""),s=r.getTime().toString().slice(-4);return"".concat(e,"-").concat(t,"-").concat(s)},l=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),c=e=>{let r=e instanceof s.EK?e.toDate():e;return new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(r)},d=(e,r)=>{let t;return function(){for(var s=arguments.length,a=Array(s),n=0;n<s;n++)a[n]=arguments[n];clearTimeout(t),t=setTimeout(()=>e(...a),r)}}},3448:function(e,r,t){"use strict";t.d(r,{cn:function(){return n}});var s=t(1994),a=t(3335);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.m6)((0,s.W)(r))}}},function(e){e.O(0,[358,139,933,825,960,41,225,438,971,117,744],function(){return e(e.s=2987)}),_N_E=e.O()}]);