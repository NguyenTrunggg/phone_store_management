(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[830],{1860:function(e,s,n){Promise.resolve().then(n.bind(n,1647))},1647:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return k}});var a=n(7437),t=n(2265),i=n(9820),c=n(2381),l=n(279),r=n(9174),h=n(9397),d=n(5863),m=n(3247),o=n(2369),x=n(3041),u=n(9345),g=n(8930),j=n(4291),p=n(5060),v=n(3675),N=n(4749),f=n(5151),y=n(4362),b=n(4438),C=n(9376);function k(){var e;let{user:s}=(0,y.aC)(),[n,k]=(0,t.useState)([]),[w,S]=(0,t.useState)(""),[A,z]=(0,t.useState)(!0),[T,Z]=(0,t.useState)(!1),[_,X]=(0,t.useState)(void 0),[I,O]=(0,t.useState)(!0),[V,D]=(0,t.useState)(!1),[B,L]=(0,t.useState)(!1),[K,E]=(0,t.useState)(!1),[H,P]=(0,t.useState)(null),[F,q]=(0,t.useState)([]),[G,M]=(0,t.useState)(!1),[$,R]=(0,t.useState)({name:"",phone:"",email:"",notes:""}),[Q,Y]=(0,t.useState)({}),J=(0,C.useRouter)(),U=(0,t.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s){if(A||!I)return}else z(!0),k([]),X(void 0),O(!0);z(!0);let n=await N.C.searchCustomers({searchTerm:e,limit:10,startAfter:s?_:void 0,sortBy:"createdAt",sortOrder:"desc",isActive:!0});n.success&&n.data?(k(e=>s?[...e,...n.data.data]:n.data.data),X(n.data.lastDoc),O(n.data.hasMore)):b.Am.error("Lỗi tải danh s\xe1ch kh\xe1ch h\xe0ng",{description:n.error}),z(!1)},[_,I,A]);(0,t.useEffect)(()=>{U(w)},[w]);let W=async()=>{if(!s){b.Am.error("Bạn phải đăng nhập để thực hiện chức năng n\xe0y.");return}if(!$.name||!$.phone){b.Am.warning("Vui l\xf2ng nhập t\xean v\xe0 số điện thoại kh\xe1ch h\xe0ng.");return}Z(!0);let e=await N.C.createCustomer($,s.uid);e.success&&e.data?(b.Am.success("Đ\xe3 th\xeam kh\xe1ch h\xe0ng ".concat(e.data.name," th\xe0nh c\xf4ng!")),k(s=>[e.data,...s]),D(!1),R({name:"",phone:"",email:"",notes:""})):b.Am.error("Th\xeam kh\xe1ch h\xe0ng thất bại",{description:e.error}),Z(!1)},ee=async()=>{if(!s||!H){b.Am.error("Kh\xf4ng c\xf3 th\xf4ng tin kh\xe1ch h\xe0ng hoặc người d\xf9ng.");return}Z(!0);let e=await N.C.updateCustomer(H.id,Q,s.uid);e.success&&e.data?(b.Am.success("Cập nhật kh\xe1ch h\xe0ng ".concat(e.data.name," th\xe0nh c\xf4ng!")),k(s=>s.map(s=>s.id===e.data.id?e.data:s)),L(!1),Y({})):b.Am.error("Cập nhật thất bại",{description:e.error}),Z(!1)},es=async e=>{if(!s){b.Am.error("Bạn phải đăng nhập để thực hiện chức năng n\xe0y.");return}if(!confirm("Bạn c\xf3 chắc chắn muốn x\xf3a kh\xe1ch h\xe0ng ".concat(e.name,"? Thao t\xe1c n\xe0y sẽ ẩn kh\xe1ch h\xe0ng khỏi c\xe1c danh s\xe1ch.")))return;Z(!0);let n=await N.C.deleteCustomer(e.id,s.uid);n.success?(b.Am.success("Đ\xe3 x\xf3a kh\xe1ch h\xe0ng ".concat(e.name,".")),k(s=>s.filter(s=>s.id!==e.id))):b.Am.error("X\xf3a thất bại",{description:n.error}),Z(!1)},en=e=>{P(e),Y({name:e.name,phone:e.phone,email:e.email,notes:e.notes}),L(!0)},ea=async e=>{P(e),E(!0),M(!0);let s=await f.u.getSalesOrdersByCustomerId(e.id);s.success&&s.data?q(s.data):(b.Am.error("Lỗi tải lịch sử mua h\xe0ng",{description:s.error}),q([])),M(!1)},et=e=>{switch(e){case"vip":return(0,a.jsx)(r.C,{className:"bg-purple-100 text-purple-800",children:"VIP"});case"platinum":return(0,a.jsx)(r.C,{className:"bg-blue-100 text-blue-800",children:"Platinum"});case"regular":return(0,a.jsx)(r.C,{variant:"secondary",children:"Thường xuy\xean"});case"new":return(0,a.jsx)(r.C,{className:"bg-green-100 text-green-800",children:"Mới"});default:return(0,a.jsx)(r.C,{variant:"outline",children:"Kh\xe1ch h\xe0ng"})}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Quản l\xfd kh\xe1ch h\xe0ng"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Theo d\xf5i th\xf4ng tin v\xe0 lịch sử mua h\xe0ng của kh\xe1ch h\xe0ng"})]}),(0,a.jsxs)(j.Vq,{open:V,onOpenChange:D,children:[(0,a.jsx)(j.hg,{asChild:!0,children:(0,a.jsxs)(c.z,{children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Th\xeam kh\xe1ch h\xe0ng"]})}),(0,a.jsxs)(j.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(j.fK,{children:[(0,a.jsx)(j.$N,{children:"Th\xeam kh\xe1ch h\xe0ng mới"}),(0,a.jsx)(j.Be,{children:"Tạo th\xf4ng tin kh\xe1ch h\xe0ng trong hệ thống"})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"name",children:"Họ v\xe0 t\xean"}),(0,a.jsx)(l.I,{id:"name",value:$.name,onChange:e=>R({...$,name:e.target.value}),placeholder:"Nguyễn Văn A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"phone",children:"Số điện thoại"}),(0,a.jsx)(l.I,{id:"phone",value:$.phone,onChange:e=>R({...$,phone:e.target.value}),placeholder:"09XXXXXXXX"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"email",children:"Email"}),(0,a.jsx)(l.I,{id:"email",type:"email",value:$.email,onChange:e=>R({...$,email:e.target.value}),placeholder:"email@example.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"address",children:"Địa chỉ (Đường)"}),(0,a.jsx)(v.g,{id:"address",value:null===(e=$.address)||void 0===e?void 0:e.street,onChange:e=>R({...$,address:{...$.address,street:e.target.value}}),placeholder:"123 Nguyễn Huệ"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{htmlFor:"notes",children:"Ghi ch\xfa"}),(0,a.jsx)(v.g,{id:"notes",value:$.notes,onChange:e=>R({...$,notes:e.target.value}),placeholder:"Ghi ch\xfa th\xeam về kh\xe1ch h\xe0ng..."})]})]}),(0,a.jsxs)(j.cN,{children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>D(!1),children:"Hủy"}),(0,a.jsxs)(c.z,{onClick:W,disabled:T,children:[T&&(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Tạo kh\xe1ch h\xe0ng"]})]})]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(i.ll,{children:"Danh s\xe1ch kh\xe1ch h\xe0ng"}),(0,a.jsxs)("div",{className:"relative w-64",children:[(0,a.jsx)(m.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,a.jsx)(l.I,{placeholder:"T\xecm theo t\xean...",value:w,onChange:e=>S(e.target.value),className:"pl-10"})]})]})}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[A&&0===n.length?(0,a.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,a.jsx)(d.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}):n.length>0?n.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.phone&&(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3 mr-1"}),e.phone]}),e.email&&(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-3 h-3 mr-1"}),e.email]})]})]})]}),(0,a.jsx)("div",{className:"text-right",children:et(e.customerTier)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Tổng chi ti\xeau"}),(0,a.jsxs)("p",{className:"font-bold text-lg text-blue-600",children:[e.totalSpent.toLocaleString("vi-VN"),"₫"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Số đơn h\xe0ng"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:e.totalOrders})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Mua gần nhất"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:e.lastPurchaseDate?e.lastPurchaseDate.toDate().toLocaleDateString("vi-VN"):"Chưa c\xf3"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-3",children:[(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>ea(e),children:"Xem lịch sử"}),(0,a.jsxs)(j.Vq,{open:B&&(null==H?void 0:H.id)===e.id,onOpenChange:e=>!e&&L(!1),children:[(0,a.jsx)(j.hg,{asChild:!0,children:(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>en(e),children:"Chỉnh sửa"})}),(0,a.jsxs)(j.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(j.fK,{children:[(0,a.jsx)(j.$N,{children:"Chỉnh sửa kh\xe1ch h\xe0ng"}),(0,a.jsxs)(j.Be,{children:["Cập nhật th\xf4ng tin cho ",null==H?void 0:H.name]})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{children:"Họ v\xe0 t\xean"}),(0,a.jsx)(l.I,{value:Q.name,onChange:e=>Y({...Q,name:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{children:"Số điện thoại"}),(0,a.jsx)(l.I,{value:Q.phone,onChange:e=>Y({...Q,phone:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{children:"Email"}),(0,a.jsx)(l.I,{value:Q.email,onChange:e=>Y({...Q,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{children:"Ghi ch\xfa"}),(0,a.jsx)(v.g,{value:Q.notes,onChange:e=>Y({...Q,notes:e.target.value})})]})]}),(0,a.jsxs)(j.cN,{children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>L(!1),children:"Hủy"}),(0,a.jsxs)(c.z,{onClick:ee,disabled:T,children:[T&&(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Lưu thay đổi"]})]})]})]}),(0,a.jsx)(c.z,{size:"sm",onClick:()=>{b.Am.info("Chức năng tạo đơn h\xe0ng sẽ chuyển bạn đến trang POS.")},children:"Tạo đơn h\xe0ng"}),(0,a.jsxs)(c.z,{variant:"destructive",size:"sm",onClick:()=>es(e),disabled:T,children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-1"}),"X\xf3a"]})]})]},e.id)):(0,a.jsxs)("div",{className:"text-center p-8 text-gray-500",children:[(0,a.jsx)("p",{children:"Kh\xf4ng t\xecm thấy kh\xe1ch h\xe0ng n\xe0o."}),(0,a.jsx)("p",{className:"text-sm",children:"H\xe3y thử thay đổi từ kh\xf3a t\xecm kiếm hoặc th\xeam kh\xe1ch h\xe0ng mới."})]}),I&&!A&&(0,a.jsx)("div",{className:"text-center mt-4",children:(0,a.jsx)(c.z,{onClick:()=>U(w,!0),disabled:A,children:A?(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2 animate-spin"}):"Tải th\xeam"})})]})})]}),(0,a.jsx)(j.Vq,{open:K,onOpenChange:E,children:(0,a.jsxs)(j.cZ,{className:"sm:max-w-[700px]",children:[(0,a.jsxs)(j.fK,{children:[(0,a.jsxs)(j.$N,{children:["Lịch sử mua h\xe0ng - ",null==H?void 0:H.name]}),(0,a.jsx)(j.Be,{children:"Chi tiết c\xe1c đơn h\xe0ng đ\xe3 mua"})]}),(0,a.jsx)("div",{className:"space-y-4 max-h-[400px] overflow-y-auto p-2",children:G?(0,a.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,a.jsx)(d.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}):F.length>0?F.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"font-medium text-blue-600",children:e.orderNumber}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.orderDate.toDate().toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-sm",children:[e.totalItems," sản phẩm"]}),(0,a.jsxs)("p",{className:"font-bold text-lg",children:[e.totalAmount.toLocaleString("vi-VN"),"₫"]})]}),(0,a.jsx)(c.z,{size:"sm",variant:"link",className:"p-0 h-auto mt-1",onClick:()=>J.push("/pos/receipt/".concat(e.id)),children:"Xem chi tiết h\xf3a đơn"})]},e.id)):(0,a.jsx)("div",{className:"text-center p-8 text-gray-500",children:(0,a.jsx)("p",{children:"Kh\xe1ch h\xe0ng n\xe0y chưa c\xf3 lịch sử mua h\xe0ng."})})})]})})]})}},3675:function(e,s,n){"use strict";n.d(s,{g:function(){return c}});var a=n(7437),t=n(2265),i=n(3448);let c=t.forwardRef((e,s)=>{let{className:n,...t}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:s,...t})});c.displayName="Textarea"}},function(e){e.O(0,[358,139,933,825,960,438,339,252,362,995,971,117,744],function(){return e(e.s=1860)}),_N_E=e.O()}]);