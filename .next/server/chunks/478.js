"use strict";exports.id=478,exports.ids=[478],exports.modules={80413:(e,t,r)=>{r.d(t,{$D:()=>u,N9:()=>N,Ul:()=>T,eM:()=>E,sM:()=>s});let E={IN_STOCK:"in_stock",SOLD:"sold",RESERVED:"reserved",RETURNED:"returned",RETURNED_AVAILABLE:"returned_available",DEFECTIVE:"defective",UNDER_REPAIR:"under_repair",WARRANTY_OUT:"warranty_out",WARRANTY_IN:"warranty_in"};E.IN_STOCK,E.SOLD,E.RESERVED,E.RETURNED,E.RETURNED_AVAILABLE,E.DEFECTIVE,E.UNDER_REPAIR,E.WARRANTY_OUT,E.WARRANTY_IN;let s=[E.IN_STOCK,E.RETURNED_AVAILABLE,E.WARRANTY_IN],a={ACTIVE:"active",INACTIVE:"inactive",COMING_SOON:"coming_soon"};a.ACTIVE,a.INACTIVE,a.COMING_SOON;let c={COMPLETED:"completed",PENDING:"pending",CANCELLED:"cancelled",PROCESSING_RETURN:"processing_return",RETURNED:"returned",PARTIALLY_RETURNED:"partially_returned"};c.COMPLETED,c.PENDING,c.CANCELLED,c.PROCESSING_RETURN,c.RETURNED,c.PARTIALLY_RETURNED;let i={PAID:"paid",PENDING:"pending",FAILED:"failed",PARTIAL_REFUND:"partial_refund",FULL_REFUND:"full_refund",CANCELLED:"cancelled"};i.PAID,i.PENDING,i.FAILED,i.PARTIAL_REFUND,i.FULL_REFUND,i.CANCELLED;let n={CASH:"cash",BANK_TRANSFER:"bank_transfer",CREDIT_CARD:"credit_card",DEBIT_CARD:"debit_card",APPLE_PAY:"apple_pay",QR_CODE:"qr_code"};n.CASH,n.BANK_TRANSFER,n.CREDIT_CARD,n.DEBIT_CARD,n.APPLE_PAY,n.QR_CODE;let d={PENDING_APPROVAL:"pending_approval",APPROVED:"approved",REJECTED:"rejected",PROCESSED:"processed",REFUNDED:"refunded",EXCHANGED:"exchanged"};d.PENDING_APPROVAL,d.APPROVED,d.REJECTED,d.PROCESSED,d.REFUNDED,d.EXCHANGED;let o={DEFECTIVE:"defective",WRONG_MODEL:"wrong_model",CUSTOMER_CHANGED_MIND:"customer_changed_mind",DAMAGED_SHIPPING:"damaged_shipping",NOT_AS_DESCRIBED:"not_as_described",OTHER:"other"};o.DEFECTIVE,o.WRONG_MODEL,o.CUSTOMER_CHANGED_MIND,o.DAMAGED_SHIPPING,o.NOT_AS_DESCRIBED,o.OTHER;let R={REFUND:"refund",EXCHANGE:"exchange",REPAIR:"repair",STORE_CREDIT:"store_credit"};R.REFUND,R.EXCHANGE,R.REPAIR,R.STORE_CREDIT;let l={PENDING:"pending",PARTIALLY_RECEIVED:"partially_received",COMPLETED:"completed",CANCELLED:"cancelled"};l.PENDING,l.PARTIALLY_RECEIVED,l.COMPLETED,l.CANCELLED;let A={WAREHOUSE_STAFF:"warehouse_staff",SALES_STAFF:"sales_staff",STORE_MANAGER:"store_manager",ADMIN:"admin"};A.WAREHOUSE_STAFF,A.SALES_STAFF,A.STORE_MANAGER,A.ADMIN,A.WAREHOUSE_STAFF,A.SALES_STAFF,A.STORE_MANAGER,A.ADMIN;let u={IMPORT:"import",SALE:"sale",RETURN:"return",ADJUSTMENT:"adjustment",TRANSFER:"transfer",WARRANTY_OUT:"warranty_out",WARRANTY_IN:"warranty_in",DAMAGED:"damaged",LOST:"lost"};u.IMPORT,u.SALE,u.RETURN,u.ADJUSTMENT,u.TRANSFER,u.WARRANTY_OUT,u.WARRANTY_IN,u.DAMAGED,u.LOST;let T={USERS:"users",PRODUCTS:"products",VARIANTS:"variants",INVENTORY:"inventory",SALES_ORDERS:"salesOrders",ORDER_ITEMS:"orderItems",CUSTOMERS:"customers",SUPPLIERS:"suppliers",PURCHASE_ORDERS:"purchaseOrders",RETURNS:"returns",RETURN_ITEMS:"returnItems",STOCK_MOVEMENTS:"stockMovements",REPORTS:"reports"},N={VARIANTS:"variants",ORDER_ITEMS:"orderItems",RETURN_ITEMS:"returnItems"}},90097:(e,t,r)=>{r.d(t,{Ds:()=>o,bQ:()=>a,eJ:()=>c,m1:()=>i,p6:()=>d,xG:()=>n});var E=r(76),s=r(90445);class a{constructor(e){this.collectionName=e,this.collectionRef=(0,E.hJ)(s.db,e)}handleError(e){if(console.error(`${this.collectionName} service error:`,e),e instanceof E.WA)switch(e.code){case"permission-denied":return{success:!1,error:"Bạn kh\xf4ng c\xf3 quyền thực hiện thao t\xe1c n\xe0y",errorCode:"PERMISSION_DENIED"};case"not-found":return{success:!1,error:"Kh\xf4ng t\xecm thấy dữ liệu y\xeau cầu",errorCode:"NOT_FOUND"};case"unavailable":return{success:!1,error:"Dịch vụ tạm thời kh\xf4ng khả dụng, vui l\xf2ng thử lại",errorCode:"UNAVAILABLE"};case"deadline-exceeded":return{success:!1,error:"Thao t\xe1c qu\xe1 thời gian chờ, vui l\xf2ng thử lại",errorCode:"TIMEOUT"};default:return{success:!1,error:`Lỗi hệ thống: ${e.message}`,errorCode:e.code.toUpperCase()}}return{success:!1,error:"Đ\xe3 xảy ra lỗi kh\xf4ng x\xe1c định",errorCode:"UNKNOWN_ERROR"}}buildQuery(e={}){let t=[];return e.where&&e.where.forEach(e=>{t.push((0,E.ar)(e.field,e.operator,e.value))}),e.orderBy&&e.orderBy.forEach(e=>{t.push((0,E.Xo)(e.field,e.direction))}),e.startAfter&&t.push((0,E.TQ)(e.startAfter)),e.limit&&t.push((0,E.b9)(e.limit)),(0,E.IO)(this.collectionRef,...t)}addAuditFields(e,t,r=!1){let s=E.EK.now(),a={updatedAt:s};return t&&(a.updatedBy=t),!r&&(a.createdAt=s,t&&(a.createdBy=t)),{...e,...a}}documentToObject(e){return{id:e.id,...e.data()}}async create(e,t){try{let r=this.addAuditFields(e,t,!1),s=await (0,E.ET)(this.collectionRef,r),a=await (0,E.QT)(s);if(!a.exists())return{success:!1,error:"Kh\xf4ng thể tạo mới dữ liệu",errorCode:"CREATE_FAILED"};return{success:!0,data:this.documentToObject(a)}}catch(e){return this.handleError(e)}}async getById(e){try{let t=(0,E.JU)(this.collectionRef,e),r=await (0,E.QT)(t);if(!r.exists())return{success:!1,error:"Kh\xf4ng t\xecm thấy dữ liệu",errorCode:"NOT_FOUND"};return{success:!0,data:this.documentToObject(r)}}catch(e){return this.handleError(e)}}async update(e,t,r){try{let s=(0,E.JU)(this.collectionRef,e),a=this.addAuditFields(t,r,!0);await (0,E.r7)(s,a);let c=await (0,E.QT)(s);if(!c.exists())return{success:!1,error:"Kh\xf4ng thể cập nhật dữ liệu",errorCode:"UPDATE_FAILED"};return{success:!0,data:this.documentToObject(c)}}catch(e){return this.handleError(e)}}async delete(e,t){try{let r=(0,E.JU)(this.collectionRef,e);try{return await (0,E.r7)(r,{isDeleted:!0,deletedAt:E.EK.now(),deletedBy:t,updatedAt:E.EK.now(),updatedBy:t}),{success:!0}}catch(e){return await (0,E.oe)(r),{success:!0}}}catch(e){return this.handleError(e)}}async list(e={}){try{let t=this.buildQuery(e),r=await (0,E.PL)(t),s=r.docs.map(e=>this.documentToObject(e)),a=r.docs[r.docs.length-1],c=r.docs.length===(e.limit||s.length);return{success:!0,data:{data:s,lastDoc:a,hasMore:c}}}catch(e){return this.handleError(e)}}async search(e,t,r={}){try{let s=t.map(async t=>{let s=(0,E.IO)(this.collectionRef,(0,E.ar)(t,">=",e),(0,E.ar)(t,"<=",e+""),...r.limit?[(0,E.b9)(r.limit)]:[]);return(await (0,E.PL)(s)).docs.map(e=>this.documentToObject(e))}),a=(await Promise.all(s)).flat().filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));return{success:!0,data:a}}catch(e){return this.handleError(e)}}async batchCreate(e,t){try{let r=(0,E.qs)(s.db),a=[];e.forEach(e=>{let s=(0,E.JU)(this.collectionRef),c=this.addAuditFields(e,t,!1);r.set(s,c),a.push(s)}),await r.commit();let c=await Promise.all(a.map(async e=>{let t=await (0,E.QT)(e);return this.documentToObject(t)}));return{success:!0,data:c}}catch(e){return this.handleError(e)}}async runTransaction(e){try{let t=await (0,E.i3)(s.db,e);return{success:!0,data:t}}catch(e){return this.handleError(e)}}async exists(e){try{let t=(0,E.JU)(this.collectionRef,e),r=await (0,E.QT)(t);return{success:!0,data:r.exists()}}catch(e){return this.handleError(e)}}async count(e={}){try{let t=this.buildQuery(e),r=await (0,E.PL)(t);return{success:!0,data:r.size}}catch(e){return this.handleError(e)}}}let c=e=>/^\d{15}$/.test(e),i=(e="SO")=>{let t=new Date,r=t.toISOString().slice(0,10).replace(/-/g,""),E=t.getTime().toString().slice(-4);return`${e}-${r}-${E}`},n=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),d=e=>{let t=e instanceof E.EK?e.toDate():e;return new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)},o=(e,t)=>{let r;return(...E)=>{clearTimeout(r),r=setTimeout(()=>e(...E),t)}}}};