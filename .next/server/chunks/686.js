"use strict";exports.id=686,exports.ids=[686],exports.modules={12714:(e,t,r)=>{r.d(t,{Z:()=>a});let a=(0,r(76557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},70003:(e,t,r)=>{r.d(t,{Z:()=>a});let a=(0,r(76557).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},98091:(e,t,r)=>{r.d(t,{Z:()=>a});let a=(0,r(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},24118:(e,t,r)=>{r.d(t,{$N:()=>g,Be:()=>h,Vq:()=>c,cN:()=>f,cZ:()=>m,fK:()=>p,hg:()=>l});var a=r(10326),s=r(17577),o=r(98958),i=r(94019),n=r(51223);let c=o.fC,l=o.xz,d=o.h_;o.x8;let u=s.forwardRef(({className:e,...t},r)=>a.jsx(o.aV,{ref:r,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=o.aV.displayName;let m=s.forwardRef(({className:e,children:t,...r},s)=>(0,a.jsxs)(d,{children:[a.jsx(u,{}),(0,a.jsxs)(o.VY,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,(0,a.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(i.Z,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=o.VY.displayName;let p=({className:e,...t})=>a.jsx("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let f=({className:e,...t})=>a.jsx("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});f.displayName="DialogFooter";let g=s.forwardRef(({className:e,...t},r)=>a.jsx(o.Dx,{ref:r,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));g.displayName=o.Dx.displayName;let h=s.forwardRef(({className:e,...t},r)=>a.jsx(o.dk,{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));h.displayName=o.dk.displayName},41190:(e,t,r)=>{r.d(t,{I:()=>i});var a=r(10326),s=r(17577),o=r(51223);let i=s.forwardRef(({className:e,type:t,...r},s)=>a.jsx("input",{type:t,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...r}));i.displayName="Input"},44794:(e,t,r)=>{r.d(t,{_:()=>l});var a=r(10326),s=r(17577),o=r(34478),i=r(79360),n=r(51223);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef(({className:e,...t},r)=>a.jsx(o.f,{ref:r,className:(0,n.cn)(c(),e),...t}));l.displayName=o.f.displayName},29280:(e,t,r)=>{r.d(t,{Bw:()=>g,Ph:()=>d,Ql:()=>h,i4:()=>m,ki:()=>u});var a=r(10326),s=r(17577),o=r(38785),i=r(941),n=r(96633),c=r(32933),l=r(51223);let d=o.fC;o.ZA;let u=o.B4,m=s.forwardRef(({className:e,children:t,...r},s)=>(0,a.jsxs)(o.xz,{ref:s,className:(0,l.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,a.jsx(o.JO,{asChild:!0,children:a.jsx(i.Z,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=o.xz.displayName;let p=s.forwardRef(({className:e,...t},r)=>a.jsx(o.u_,{ref:r,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(n.Z,{className:"h-4 w-4"})}));p.displayName=o.u_.displayName;let f=s.forwardRef(({className:e,...t},r)=>a.jsx(o.$G,{ref:r,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(i.Z,{className:"h-4 w-4"})}));f.displayName=o.$G.displayName;let g=s.forwardRef(({className:e,children:t,position:r="popper",...s},i)=>a.jsx(o.h_,{children:(0,a.jsxs)(o.VY,{ref:i,className:(0,l.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...s,children:[a.jsx(p,{}),a.jsx(o.l_,{className:(0,l.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),a.jsx(f,{})]})}));g.displayName=o.VY.displayName,s.forwardRef(({className:e,...t},r)=>a.jsx(o.__,{ref:r,className:(0,l.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=o.__.displayName;let h=s.forwardRef(({className:e,children:t,...r},s)=>(0,a.jsxs)(o.ck,{ref:s,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(o.wU,{children:a.jsx(c.Z,{className:"h-4 w-4"})})}),a.jsx(o.eT,{children:t})]}));h.displayName=o.ck.displayName,s.forwardRef(({className:e,...t},r)=>a.jsx(o.Z0,{ref:r,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=o.Z0.displayName},82015:(e,t,r)=>{r.d(t,{g:()=>i});var a=r(10326),s=r(17577),o=r(51223);let i=s.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));i.displayName="Textarea"},18695:(e,t,r)=>{r.d(t,{_:()=>l});var a=r(76),s=r(90445),o=r(90097),i=r(80413);function n(e){return!!e&&"string"==typeof e&&/^[A-Za-z0-9][A-Za-z0-9_-]{1,18}[A-Za-z0-9]$/.test(e.trim())}class c extends o.bQ{constructor(){super(i.Ul.PRODUCTS)}async createProduct(e,t){try{if(console.log("=== Product Creation Debug ==="),console.log("Input:",e),console.log("User ID:",t),!e.name?.trim())return{success:!1,error:"T\xean sản phẩm kh\xf4ng được để trống",errorCode:"INVALID_PRODUCT_NAME"};console.log("Checking for duplicate product name:",e.name.trim());let r=await this.findProductByName(e.name.trim());if(r.success&&r.data)return console.error("Duplicate product name found:",e.name.trim()),{success:!1,error:"T\xean sản phẩm đ\xe3 tồn tại",errorCode:"DUPLICATE_PRODUCT_NAME"};let a=e.slug||e.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").trim();console.log("Generated slug:",a);let s={name:e.name.trim(),slug:a,totalVariants:0,activeVariants:0,totalStock:0,averagePrice:0,isActive:!0};e.description&&(s.description=e.description.trim()),s.brand=e.brand?.trim()||"Apple",s.category=e.category?.trim()||"Smartphones",s.tags=e.tags||[],s.attributes=e.attributes||{},s.images=[],e.baseImageUrl?.trim()&&(s.baseImageUrl=e.baseImageUrl.trim()),void 0!==e.displayOrder&&(s.displayOrder=e.displayOrder),e.internalNotes?.trim()&&(s.internalNotes=e.internalNotes.trim()),console.log("Final product data to be saved:",s);let o=await this.create(s,t);return console.log("Product creation result:",o),o}catch(e){return console.error("Error in createProduct:",e),this.handleError(e)}}async updateProduct(e,t,r){try{let s=await this.exists(e);if(!s.success||!s.data)return{success:!1,error:"Kh\xf4ng t\xecm thấy sản phẩm",errorCode:"PRODUCT_NOT_FOUND"};if(t.name){let r=await this.findProductByName(t.name.trim());if(r.success&&r.data&&r.data.id!==e)return{success:!1,error:"T\xean sản phẩm đ\xe3 tồn tại",errorCode:"DUPLICATE_PRODUCT_NAME"}}let o={...t,updatedAt:a.EK.now(),updatedBy:r};return t.name&&(o.name=t.name.trim()),await this.update(e,o,r)}catch(e){return this.handleError(e)}}async getProductWithVariants(e){try{let t=await this.getById(e);if(!t.success)return t;let r=await this.getVariantsByProductId(e);if(!r.success)return{success:!1,error:"Kh\xf4ng thể lấy th\xf4ng tin biến thể sản phẩm",errorCode:"VARIANTS_FETCH_FAILED"};let a=r.data||[],s=a.reduce((e,t)=>e+t.stockQuantity,0),o={...t.data,variants:a,totalStock:s};return{success:!0,data:o}}catch(e){return this.handleError(e)}}async getProductsWithVariantsForDropdown(){try{console.log("=== Getting products with variants for dropdown ===");let e=(0,a.IO)((0,a.hJ)(s.db,i.Ul.PRODUCTS),(0,a.ar)("isActive","==",!0)),t=await (0,a.PL)(e);console.log("Found products:",t.size),t.docs.forEach((e,t)=>{let r=e.data();console.log(`Product ${t+1}:`,{id:e.id,name:r.name,isActive:r.isActive,allFields:r})});let r=await Promise.all(t.docs.map(async e=>{let t=e.data();console.log(`
=== Processing product: ${t.name} (${e.id}) ===`);try{let r=(0,a.IO)((0,a.hJ)(s.db,"products",e.id,"variants"),(0,a.ar)("isActive","==",!0));console.log(`Query path: products/${e.id}/variants`);let o=await (0,a.PL)(r);if(console.log(`Found ${o.size} variants for ${t.name}`),0===o.size){console.log(`❌ No variants found for ${t.name}`);let r=(0,a.hJ)(s.db,"products",e.id,"variants"),o=await (0,a.PL)(r);console.log(`Total variants (ignoring isActive): ${o.size}`),o.docs.forEach((e,t)=>{let r=e.data();console.log(`  Variant ${t+1}:`,{id:e.id,isActive:r.isActive,sku:r.sku,colorName:r.colorName,storageCapacity:r.storageCapacity,allFields:r})})}else o.docs.forEach((e,t)=>{let r=e.data();console.log(`  Active Variant ${t+1}:`,{id:e.id,sku:r.sku,colorName:r.colorName,storageCapacity:r.storageCapacity,retailPrice:r.retailPrice,isActive:r.isActive})});let i=o.docs.map(e=>{let t=e.data();return console.log(`Processing variant ${e.id}:`,{storageCapacity:t.storageCapacity,colorName:t.colorName,sku:t.sku,retailPrice:t.retailPrice}),{id:e.id,storageCapacity:t.storageCapacity||"Unknown",colorName:t.colorName||"Unknown",sku:t.sku||"NO-SKU",price:t.retailPrice||0}});return console.log(`Final variants for ${t.name}:`,i),{id:e.id,name:t.name,variants:i}}catch(r){return console.error(`❌ Error loading variants for ${t.name}:`,r),{id:e.id,name:t.name,variants:[]}}}));console.log("\n=== All products before filtering ==="),r.forEach((e,t)=>{console.log(`Product ${t+1}: ${e.name} - ${e.variants.length} variants`)});let o=r.filter(e=>e.variants.length>0);return console.log("\n=== Products after filtering (with variants only) ==="),console.log(`Filtered: ${o.length}/${r.length} products`),o.forEach((e,t)=>{console.log(`Product ${t+1}: ${e.name} - ${e.variants.length} variants`)}),{success:!0,data:o}}catch(e){return console.error("❌ Error getting products with variants for dropdown:",e),this.handleError(e)}}async searchProducts(e={}){try{let t=[];void 0!==e.isActive&&t.push((0,a.ar)("isActive","==",e.isActive)),e.brand&&t.push((0,a.ar)("brand","==",e.brand)),e.category&&t.push((0,a.ar)("category","==",e.category)),e.tags&&e.tags.length>0&&t.push((0,a.ar)("tags","array-contains-any",e.tags));let r=e.sortBy||"name",s=e.sortOrder||"asc";t.push((0,a.Xo)(r,s));let o=(0,a.IO)(this.collectionRef,...t),i=(await (0,a.PL)(o)).docs.map(e=>({id:e.id,...e.data()}));if(e.searchTerm){let t=e.searchTerm.toLowerCase();i=i.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags?.some(e=>e.toLowerCase().includes(t)))}return{success:!0,data:i}}catch(e){return this.handleError(e)}}async findProductByName(e){try{let t=(0,a.IO)(this.collectionRef,(0,a.ar)("name","==",e)),r=await (0,a.PL)(t);if(r.empty)return{success:!0,data:null};let s=r.docs[0];return{success:!0,data:{id:s.id,...s.data()}}}catch(e){return this.handleError(e)}}async createVariant(e,t,r="system"){try{let o;console.log("=== Variant Creation Debug ==="),console.log("Product ID:",e),console.log("Input:",t),console.log("User ID (fixed):",r);let c=t.sku||this.generateSKU(t.colorName,t.storageCapacity);if(console.log("Generated/Provided SKU:",c),!c?.trim())return console.error("SKU validation failed - empty SKU:",c),{success:!1,error:"M\xe3 SKU kh\xf4ng được để trống",errorCode:"INVALID_SKU"};console.log("Validating SKU format:",c.trim());try{o=n(c.trim()),console.log("SKU validation result:",o)}catch(e){return console.error("SKU validation function error:",e),{success:!1,error:"Lỗi kiểm tra định dạng SKU",errorCode:"SKU_VALIDATION_ERROR"}}if(!o)return console.error("SKU format validation failed:",c),{success:!1,error:`M\xe3 SKU kh\xf4ng đ\xfang định dạng: ${c}`,errorCode:"INVALID_SKU_FORMAT"};if(!t.colorName?.trim()||!t.storageCapacity?.trim())return console.error("Color/Storage validation failed:",{colorName:t.colorName,storageCapacity:t.storageCapacity}),{success:!1,error:"M\xe0u sắc v\xe0 dung lượng kh\xf4ng được để trống",errorCode:"INVALID_VARIANT_INFO"};if(!t.retailPrice||t.retailPrice<=0)return console.error("Price validation failed:",t.retailPrice),{success:!1,error:"Gi\xe1 sản phẩm phải lớn hơn 0",errorCode:"INVALID_PRICE"};console.log("Checking if product exists:",e);let l=await this.exists(e);if(console.log("Product exists result:",l),!l.success||!l.data)return console.error("Product not found:",e),{success:!1,error:"Kh\xf4ng t\xecm thấy sản phẩm",errorCode:"PRODUCT_NOT_FOUND"};console.log("Checking for duplicate SKU:",c.trim());let d=await this.findVariantBySKU(c.trim());if(console.log("Existing variant check result:",d),d.success&&d.data)return console.error("Duplicate SKU found:",c),{success:!1,error:`M\xe3 SKU đ\xe3 tồn tại: ${c}`,errorCode:"DUPLICATE_SKU"};console.log("Checking for duplicate variant in product:",e);let u=await this.findVariantByProductAndAttributes(e,t.colorName.trim(),t.storageCapacity.trim());if(console.log("Duplicate variant check result:",u),u.success&&u.data)return console.error("Duplicate variant found in product:",{productId:e,colorName:t.colorName,storageCapacity:t.storageCapacity}),{success:!1,error:"Biến thể sản phẩm đ\xe3 tồn tại",errorCode:"DUPLICATE_VARIANT"};let m={productId:e,sku:c.trim().toUpperCase(),colorName:t.colorName.trim(),storageCapacity:t.storageCapacity.trim(),retailPrice:t.retailPrice,status:"active",isActive:!0,isFeatured:!1,attributes:t.attributes||{},stockQuantity:0,reservedQuantity:0,soldQuantity:0,totalQuantity:0,lowStockThreshold:t.lowStockThreshold||5,reorderLevel:t.reorderLevel||10,lastStockUpdate:a.EK.now(),createdAt:a.EK.now(),updatedAt:a.EK.now(),createdBy:r,updatedBy:r};void 0!==t.costPrice&&t.costPrice>=0&&(m.costPrice=t.costPrice),t.colorHex?.trim()&&(m.colorHex=t.colorHex.trim()),void 0!==t.originalPrice&&t.originalPrice>0&&(m.originalPrice=t.originalPrice),t.imageUrl?.trim()&&(m.imageUrl=t.imageUrl.trim()),t.appleModelNumber?.trim()&&(m.appleModelNumber=t.appleModelNumber.trim()),t.applePartNumber?.trim()&&(m.applePartNumber=t.applePartNumber.trim()),t.launchDate&&(m.launchDate=a.EK.fromDate(t.launchDate)),void 0!==t.displayOrder&&(m.displayOrder=t.displayOrder),console.log("Final variant data to be saved:",m);let p=(0,a.hJ)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS);console.log("Adding variant to collection:",p.path);let f=await (0,a.ET)(p,m);console.log("Variant document created with ID:",f.id);let g=await (0,a.QT)(f);if(!g.exists())return console.error("Failed to retrieve created variant document"),{success:!1,error:"Kh\xf4ng thể tạo biến thể sản phẩm",errorCode:"VARIANT_CREATE_FAILED"};let h={id:g.id,...g.data()};return console.log("Variant created successfully:",h),{success:!0,data:h}}catch(e){return console.error("Error in createVariant:",e),this.handleError(e)}}async updateVariant(e,t,r,o){try{if(r.sku&&!n(r.sku.trim()))return{success:!1,error:"M\xe3 SKU kh\xf4ng đ\xfang định dạng",errorCode:"INVALID_SKU_FORMAT"};if(void 0!==r.retailPrice&&r.retailPrice<=0)return{success:!1,error:"Gi\xe1 sản phẩm phải lớn hơn 0",errorCode:"INVALID_PRICE"};if(r.sku){let e=await this.findVariantBySKU(r.sku.trim());if(e.success&&e.data&&e.data.id!==t)return{success:!1,error:"M\xe3 SKU đ\xe3 tồn tại",errorCode:"DUPLICATE_SKU"}}let c=(0,a.JU)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS,t),l={...r,updatedAt:a.EK.now(),updatedBy:o};r.sku&&(l.sku=r.sku.trim().toUpperCase()),await (0,a.r7)(c,l);let d=await (0,a.QT)(c);if(!d.exists())return{success:!1,error:"Kh\xf4ng thể cập nhật biến thể sản phẩm",errorCode:"VARIANT_UPDATE_FAILED"};return{success:!0,data:{id:d.id,...d.data()}}}catch(e){return this.handleError(e)}}async getVariantsByProductId(e){try{let t=(0,a.hJ)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS),r=(0,a.IO)(t,(0,a.Xo)("sku","asc")),o=(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:o}}catch(e){return this.handleError(e)}}async getVariantById(e,t){try{let r=(0,a.JU)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS,t),o=await (0,a.QT)(r);if(!o.exists())return{success:!1,error:"Kh\xf4ng t\xecm thấy biến thể sản phẩm",errorCode:"VARIANT_NOT_FOUND"};return{success:!0,data:{id:o.id,...o.data()}}}catch(e){return this.handleError(e)}}async searchVariants(e={}){try{let t=[];if(e.productId){let r=await this.getVariantsByProductId(e.productId);r.success&&(t=r.data||[])}else{let e=(0,a.hJ)(s.db,i.N9.VARIANTS),r=(0,a.IO)(e,(0,a.Xo)("sku","asc"));t=(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}if(e.searchTerm){let r=e.searchTerm.toLowerCase();t=t.filter(e=>e.sku.toLowerCase().includes(r)||e.colorName.toLowerCase().includes(r)||e.storageCapacity.toLowerCase().includes(r))}if(e.colorName&&(t=t.filter(t=>t.colorName===e.colorName)),e.storageCapacity&&(t=t.filter(t=>t.storageCapacity===e.storageCapacity)),e.status&&e.status.length>0&&(t=t.filter(t=>e.status.includes(t.status))),void 0!==e.isActive&&(t=t.filter(t=>t.isActive===e.isActive)),e.hasStock&&(t=t.filter(e=>e.stockQuantity>0)),void 0!==e.priceMin&&(t=t.filter(t=>void 0!==t.originalPrice&&t.originalPrice>=e.priceMin)),void 0!==e.priceMax&&(t=t.filter(t=>void 0!==t.originalPrice&&t.originalPrice<=e.priceMax)),e.sortBy){let r=e.sortBy,a=e.sortOrder||"asc";t.sort((e,t)=>{let s=e[r]??"",o=t[r]??"";return"asc"===a?s>o?1:-1:s<o?1:-1})}return{success:!0,data:t}}catch(e){return this.handleError(e)}}async findVariantBySKU(e){try{let t=(0,a.hJ)(s.db,i.N9.VARIANTS),r=(0,a.IO)(t,(0,a.ar)("sku","==",e.toUpperCase())),o=await (0,a.PL)(r);if(o.empty)return{success:!0,data:null};let n=o.docs[0];return{success:!0,data:{id:n.id,...n.data()}}}catch(e){return this.handleError(e)}}async findVariantByProductAndAttributes(e,t,r){try{let o=(0,a.hJ)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS),n=(0,a.IO)(o,(0,a.ar)("colorName","==",t),(0,a.ar)("storageCapacity","==",r)),c=await (0,a.PL)(n);if(c.empty)return{success:!0,data:null};let l=c.docs[0];return{success:!0,data:{id:l.id,...l.data()}}}catch(e){return this.handleError(e)}}async deleteVariant(e,t,r){try{let o=(0,a.JU)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS,t);return await (0,a.r7)(o,{isActive:!1,updatedAt:a.EK.now(),updatedBy:r}),{success:!0}}catch(e){return this.handleError(e)}}generateSKU(e,t){let r=e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().substring(0,3),a=t.replace(/[^0-9]/g,""),s=Date.now().toString().slice(-4);return`IP-${a}-${r}-${s}`}async getAvailableColors(){try{let e=(0,a.hJ)(s.db,i.N9.VARIANTS),t=(0,a.IO)(e,(0,a.ar)("isActive","==",!0)),r=await (0,a.PL)(t),o=new Set;return r.docs.forEach(e=>{let t=e.data();o.add(t.colorName)}),{success:!0,data:Array.from(o).sort()}}catch(e){return this.handleError(e)}}async getAvailableStorageCapacities(){try{let e=(0,a.hJ)(s.db,i.N9.VARIANTS),t=(0,a.IO)(e,(0,a.ar)("isActive","==",!0)),r=await (0,a.PL)(t),o=new Set;return r.docs.forEach(e=>{let t=e.data();o.add(t.storageCapacity)}),{success:!0,data:Array.from(o).sort()}}catch(e){return this.handleError(e)}}async updateVariantStock(e,t,r,o){try{let n=(0,a.JU)(s.db,i.Ul.PRODUCTS,e,i.N9.VARIANTS,t),c={stockQuantity:r,lastStockUpdate:a.EK.now(),updatedAt:a.EK.now()};return void 0!==o&&(c.reservedQuantity=o),await (0,a.r7)(n,c),{success:!0}}catch(e){return this.handleError(e)}}}let l=new c}};