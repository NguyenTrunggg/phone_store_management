"use strict";exports.id=299,exports.ids=[299],exports.modules={75290:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},88307:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},98091:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},24118:(e,t,a)=>{a.d(t,{$N:()=>f,Be:()=>y,Vq:()=>n,cN:()=>h,cZ:()=>m,fK:()=>p,hg:()=>l});var r=a(10326),s=a(17577),o=a(98958),d=a(94019),i=a(51223);let n=o.fC,l=o.xz,c=o.h_;o.x8;let u=s.forwardRef(({className:e,...t},a)=>r.jsx(o.aV,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=o.aV.displayName;let m=s.forwardRef(({className:e,children:t,...a},s)=>(0,r.jsxs)(c,{children:[r.jsx(u,{}),(0,r.jsxs)(o.VY,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[t,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(d.Z,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=o.VY.displayName;let p=({className:e,...t})=>r.jsx("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let h=({className:e,...t})=>r.jsx("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});h.displayName="DialogFooter";let f=s.forwardRef(({className:e,...t},a)=>r.jsx(o.Dx,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));f.displayName=o.Dx.displayName;let y=s.forwardRef(({className:e,...t},a)=>r.jsx(o.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));y.displayName=o.dk.displayName},41190:(e,t,a)=>{a.d(t,{I:()=>d});var r=a(10326),s=a(17577),o=a(51223);let d=s.forwardRef(({className:e,type:t,...a},s)=>r.jsx("input",{type:t,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...a}));d.displayName="Input"},44794:(e,t,a)=>{a.d(t,{_:()=>l});var r=a(10326),s=a(17577),o=a(34478),d=a(79360),i=a(51223);let n=(0,d.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef(({className:e,...t},a)=>r.jsx(o.f,{ref:a,className:(0,i.cn)(n(),e),...t}));l.displayName=o.f.displayName},56444:(e,t,a)=>{a.d(t,{C:()=>n});var r=a(76),s=a(90445),o=a(90097),d=a(80413);class i extends o.bQ{constructor(){super(d.Ul.CUSTOMERS)}async createCustomer(e,t){try{if(e.phone){let t=(0,r.IO)(this.collectionRef,(0,r.ar)("phone","==",e.phone));if(!(await (0,r.PL)(t)).empty)return{success:!1,error:"Số điện thoại đ\xe3 tồn tại.",errorCode:"DUPLICATE_PHONE"}}let a=r.EK.now(),s={name:e.name,phone:e.phone||"",email:e.email||"",addresses:e.address?[{id:"default",type:e.address.type||"home",street:e.address.street,district:e.address.district||"",city:e.address.city,country:e.address.country||"Vietnam",postalCode:e.address.postalCode||"",isDefault:!0,label:e.address.type}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,lastPurchaseDate:r.EK.now(),firstPurchaseDate:r.EK.now(),customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:e.preferredContactMethod||"phone",communicationPreferences:{promotions:e.allowMarketing??!0,newProducts:e.allowMarketing??!0,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:e.isVip||!1,isCorporate:e.isCorporate||!1,allowMarketing:e.allowMarketing??!0,requiresApproval:!1,acquisitionChannel:e.acquisitionChannel||"walk_in",referredBy:e.referredBy??"",isActive:!0,isBlacklisted:!1,createdAt:a,updatedAt:a,createdBy:t,updatedBy:t};return await this.create(s,t)}catch(e){return this.handleError(e)}}async searchCustomers(e){try{let{searchTerm:t,limit:a=10,isActive:s=!0}=e;if(!t)return{success:!0,data:{data:[],hasMore:!1}};let o=t+"",d=(0,r.IO)(this.collectionRef,(0,r.ar)("isActive","==",s),(0,r.ar)("name",">=",t),(0,r.ar)("name","<=",o)),i=(0,r.IO)(this.collectionRef,(0,r.ar)("isActive","==",s),(0,r.ar)("phone",">=",t),(0,r.ar)("phone","<=",o)),[n,l]=await Promise.all([(0,r.PL)(d),(0,r.PL)(i)]),c=new Map;n.docs.forEach(e=>{c.has(e.id)||c.set(e.id,{id:e.id,...e.data()})}),l.docs.forEach(e=>{c.has(e.id)||c.set(e.id,{id:e.id,...e.data()})});let u=Array.from(c.values()).sort((e,t)=>e.name.localeCompare(t.name)),m=u.slice(0,a);return{success:!0,data:{data:m,lastDoc:void 0,hasMore:u.length>a}}}catch(e){return this.handleError(e)}}async updateCustomer(e,t,a){try{let r={...t};return await this.update(e,r,a)}catch(e){return this.handleError(e)}}async deleteCustomer(e,t){try{return await this.update(e,{isActive:!1},t),{success:!0}}catch(e){return this.handleError(e)}}async addOrderToCustomer(e,t,a){let o=(0,r.JU)(s.db,d.Ul.CUSTOMERS,t),i=await e.get(o);if(!i.exists())throw Error(`Customer with ID ${t} not found.`);let n=i.data(),l=(n.totalOrders||0)+1,c=(n.totalSpent||0)+a.totalAmount,u={totalOrders:l,totalSpent:c,averageOrderValue:c/l,lastPurchaseDate:a.orderDate,firstPurchaseDate:n.firstPurchaseDate||a.orderDate};e.update(o,u)}async findCustomerByPhone(e){try{let t=(0,r.IO)(this.collectionRef,(0,r.ar)("phone","==",e),(0,r.b9)(1)),a=await (0,r.PL)(t);if(a.empty)return{success:!0,data:null};let s={id:a.docs[0].id,...a.docs[0].data()};return{success:!0,data:s}}catch(e){return this.handleError(e)}}}let n=new i},2922:(e,t,a)=>{a.d(t,{u:()=>n});var r=a(76),s=a(90445),o=a(90097),d=a(80413);class i extends o.bQ{constructor(){super(d.Ul.SALES_ORDERS)}async getAvailableProductsForSale(){try{let e=(0,r.hJ)(s.db,d.Ul.INVENTORY),t=(0,r.IO)(e,(0,r.ar)("status","in",d.sM)),a=await (0,r.PL)(t);if(a.empty)return{success:!0,data:[]};let o=a.docs.map(e=>({id:e.id,...e.data()})),i=new Map;for(let e of o){if(!e.productId||!e.variantId){console.warn(`Inventory item ${e.id} missing productId or variantId, skipping.`);continue}let t=i.get(e.productId);t||(t={productId:e.productId,productName:e.productName||"Unknown Product",variants:[]},i.set(e.productId,t));let a=t.variants.find(t=>t.variantId===e.variantId);a||(a={variantId:e.variantId,variantSku:e.variantSku||"Unknown SKU",colorName:e.colorName||"Unknown Color",storageCapacity:e.storageCapacity||"Unknown Storage",availableImeis:[],totalStock:0},t.variants.push(a)),a.availableImeis.push({inventoryItemId:e.id,imei:e.imei,currentRetailPrice:e.currentRetailPrice,entryDate:e.entryDate}),a.totalStock+=1}return{success:!0,data:Array.from(i.values())}}catch(e){return this.handleError(e)}}async createSaleOrder(e,t,a){try{let i,n=e.customerId;if(!n&&e.customerInfo?.phone&&e.customerInfo?.name){let t=(0,r.hJ)(s.db,d.Ul.CUSTOMERS),a=(0,r.IO)(t,(0,r.ar)("phone","==",e.customerInfo.phone),(0,r.b9)(1)),o=await (0,r.PL)(a);n=o.empty?(i=(0,r.JU)(t)).id:o.docs[0].id}return await this.runTransaction(async l=>{let c;let u=r.EK.now(),m=(0,r.JU)((0,r.hJ)(s.db,d.Ul.SALES_ORDERS)),p=(0,o.m1)("SO"),h=e.items.map(e=>(0,r.JU)(s.db,d.Ul.INVENTORY,e.inventoryItemId)),f=await Promise.all(h.map(e=>l.get(e)));if(n&&!i){let e=(0,r.JU)(s.db,d.Ul.CUSTOMERS,n);if(!(c=await l.get(e)).exists())throw Error(`Kh\xe1ch h\xe0ng với ID ${n} kh\xf4ng t\xecm thấy.`)}let y=0,g=[],I=[],x=[];for(let a=0;a<f.length;a++){let r=f[a],s=e.items[a];if(!r.exists())throw Error(`Sản phẩm với IMEI ${s.imei} kh\xf4ng t\xecm thấy trong kho.`);let o={id:r.id,...r.data()};if(o.imei!==s.imei)throw Error(`IMEI kh\xf4ng khớp cho sản phẩm ${s.inventoryItemId}.`);if(o.status!==d.eM.IN_STOCK)throw Error(`Sản phẩm ${o.productName} (${s.imei}) kh\xf4ng c\xf2n sẵn.`);let i=o.currentRetailPrice;y+=i,g.push({id:"temp-id",salesOrderId:m.id,inventoryItemId:o.id,imei:o.imei,productId:o.productId,variantId:o.variantId,productName:o.productName,variantSku:o.variantSku,colorName:o.colorName,storageCapacity:o.storageCapacity,quantity:1,unitCost:o.entryPrice,salePrice:i,itemDiscountAmount:0,itemTaxAmount:0,finalPrice:i,itemStatus:"fulfilled",entryDateOfItem:o.entryDate,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t}),I.push({ref:h[a],data:{status:d.eM.SOLD,lastStatusChange:u,salesOrderId:m.id,saleDate:u,actualSalePrice:i,warrantyStartDate:u}}),x.push({inventoryItemId:o.id,imei:o.imei,movementType:d.$D.SALE,timestamp:u,quantityChange:-1,previousStatus:d.eM.IN_STOCK,newStatus:d.eM.SOLD,fromLocation:o.currentLocation,toLocation:"Sold",userId:t,userRole:"pos_staff",reason:`B\xe1n h\xe0ng qua POS - Đơn ${p}`,relatedOrderId:m.id,relatedDocumentType:"sale",createdAt:u,updatedAt:u,createdBy:t,updatedBy:t})}if(i&&e.customerInfo?.name){let a={name:e.customerInfo.name,phone:e.customerInfo.phone,email:e.customerInfo.email||"",address:{street:e.customerInfo.address||"",city:"TP.HCM",type:"home"},acquisitionChannel:"walk_in"},s={...a,dateOfBirth:r.EK.now(),addresses:a.address?[{id:"default",street:a.address.street,city:a.address.city,country:"Vietnam",isDefault:!0,type:"home"}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:"phone",communicationPreferences:{promotions:!0,newProducts:!0,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:!1,isCorporate:!1,allowMarketing:!0,requiresApproval:!1,isActive:!0,isBlacklisted:!1,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};l.set(i,s)}let v=e.taxRate||0,S=y*v,w=e.discountAmount||0,O=e.shippingAmount||0,E=y+S-w+O,N={orderNumber:p,orderDate:u,customerInfo:e.customerInfo,subtotalAmount:y,taxRate:v,taxAmount:S,discountAmount:w,shippingAmount:O,totalAmount:E,paymentMethod:e.paymentMethod,paymentStatus:"paid",status:"completed",salesChannel:e.salesChannel||"pos",staffId:t,staffName:a||"",amountReceived:"cash"===e.paymentMethod?e.amountReceived:void 0,changeGiven:"cash"===e.paymentMethod&&e.amountReceived?e.amountReceived-E:void 0,totalItems:e.items.length,totalQuantity:e.items.length,notes:e.notes,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};if(n&&(N.customerId=n),l.set(m,N),n){let e=(0,r.JU)(s.db,d.Ul.CUSTOMERS,n),t=c?c.data():{totalOrders:0,totalSpent:0,firstPurchaseDate:u},a=(t.totalOrders||0)+1,o=(t.totalSpent||0)+E,i={totalOrders:a,totalSpent:o,averageOrderValue:o/a,lastPurchaseDate:u,firstPurchaseDate:t.firstPurchaseDate||u};l.update(e,i)}for(let e=0;e<g.length;e++){let{id:t,...a}=g[e],o=(0,r.JU)((0,r.hJ)(s.db,m.path,d.N9.ORDER_ITEMS));l.set(o,a),g[e].id=o.id}return I.forEach(e=>l.update(e.ref,e.data)),x.forEach(e=>{let t=(0,r.JU)((0,r.hJ)(s.db,d.Ul.STOCK_MOVEMENTS));l.set(t,e)}),{...N,id:m.id,items:g}})}catch(e){return console.error("Create sale order error:",e),this.handleError(e)}}async getSalesOrderByIdWithItems(e){try{let t=(0,r.JU)(s.db,d.Ul.SALES_ORDERS,e),a=await (0,r.QT)(t);if(!a.exists())return{success:!1,error:`Kh\xf4ng t\xecm thấy đơn h\xe0ng với ID: ${e}`,errorCode:"ORDER_NOT_FOUND"};let o={id:a.id,...a.data()},i=(0,r.hJ)(s.db,d.Ul.SALES_ORDERS,e,d.N9.ORDER_ITEMS),n=(await (0,r.PL)((0,r.IO)(i,(0,r.Xo)("createdAt","asc")))).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:{order:o,items:n}}}catch(t){return console.error(`Error fetching order ${e} with items:`,t),this.handleError(t)}}async getSalesOrdersByCustomerId(e){try{let t=(0,r.hJ)(s.db,d.Ul.SALES_ORDERS),a=(0,r.IO)(t,(0,r.ar)("customerId","==",e),(0,r.Xo)("orderDate","desc")),o=(await (0,r.PL)(a)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:o}}catch(e){return this.handleError(e)}}}let n=new i}};