(()=>{var e={};e.id=248,e.ids=[248],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},63203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(70180),r(58522),r(35866),r(26682);var s=r(23191),a=r(88716),n=r(37922),i=r.n(n),o=r(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["(main)",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,70180)),"D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,26682)),"D:\\phone_store_management\\phone_store_management\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\dashboard\\page.tsx"],u="/(main)/dashboard/page",m={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},44408:(e,t,r)=>{Promise.resolve().then(r.bind(r,31761))},37202:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(76557).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},71821:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(76557).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},31761:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var s=r(10326),a=r(17577),n=r(29752),i=r(38443),o=r(93095),l=r(45226),d="Progress",[c,u]=(0,o.b)(d),[m,h]=c(d),p=a.forwardRef((e,t)=>{var r,a;let{__scopeProgress:n,value:i=null,max:o,getValueLabel:d=f,...c}=e;(o||0===o)&&!j(o)&&console.error((r=`${o}`,`Invalid prop \`max\` of value \`${r}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=j(o)?o:100;null===i||N(i,u)||console.error((a=`${i}`,`Invalid prop \`value\` of value \`${a}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let h=N(i,u)?i:null,p=y(h)?d(h,u):void 0;return(0,s.jsx)(m,{scope:n,value:h,max:u,children:(0,s.jsx)(l.WV.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":y(h)?h:void 0,"aria-valuetext":p,role:"progressbar","data-state":v(h,u),"data-value":h??void 0,"data-max":u,...c,ref:t})})});p.displayName=d;var x="ProgressIndicator",g=a.forwardRef((e,t)=>{let{__scopeProgress:r,...a}=e,n=h(x,r);return(0,s.jsx)(l.WV.div,{"data-state":v(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:t})});function f(e,t){return`${Math.round(e/t*100)}%`}function v(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function y(e){return"number"==typeof e}function j(e){return y(e)&&!isNaN(e)&&e>0}function N(e,t){return y(e)&&!isNaN(e)&&e<=t&&e>=0}g.displayName=x;var w=r(51223);let b=a.forwardRef(({className:e,value:t,...r},a)=>s.jsx(p,{ref:a,className:(0,w.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:s.jsx(g,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));b.displayName=p.displayName;var S=r(71821),I=r(57671),D=r(17069),O=r(24061),E=r(37202),_=r(83495),q=r(76),P=r(90445),C=r(90097),R=r(2922),k=r(80413);class M extends C.bQ{constructor(){super("dashboard")}async getStatsForDateRange(e,t){let r=(0,q.hJ)(P.db,k.Ul.SALES_ORDERS),s=(0,q.IO)(r,(0,q.ar)("orderDate",">=",q.EK.fromDate(e)),(0,q.ar)("orderDate","<=",q.EK.fromDate(t))),a=await (0,q.PL)(s),n=0,i=new Set;return a.docs.forEach(e=>{let t=e.data();n+=t.totalAmount,t.customerId?i.add(t.customerId):t.customerInfo?.phone&&i.add(t.customerInfo.phone)}),{revenue:n,orders:a.size,customers:i}}calculatePercentageChange(e,t){return 0===t?e>0?100:0:(e-t)/t*100}async getDashboardStats(e=5,t=25e8){try{let r=new Date,s=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0),a=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59),n=new Date(r);n.setDate(r.getDate()-1);let i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0),o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59),l=new Date(r.getFullYear(),r.getMonth(),1),d=new Date(r.getFullYear(),r.getMonth()+1,0,23,59,59),[c,u]=await Promise.all([this.getStatsForDateRange(s,a),this.getStatsForDateRange(i,o)]),m=c.orders>0?c.revenue/c.orders:0,h=u.orders>0?u.revenue/u.orders:0,p={revenue:c.revenue,orders:c.orders,avgOrderValue:m,customers:c.customers.size,revenueChange:this.calculatePercentageChange(c.revenue,u.revenue),ordersChange:this.calculatePercentageChange(c.orders,u.orders),avgOrderValueChange:this.calculatePercentageChange(m,h),customersChange:this.calculatePercentageChange(c.customers.size,u.customers.size)},x=await R.u.getAvailableProductsForSale();if(!x.success||!x.data)throw Error("Could not fetch available products for inventory alerts.");let g=[];x.data.forEach(t=>{t.variants.forEach(r=>{r.totalStock<=e&&g.push({model:t.productName,variant:`${r.storageCapacity} ${r.colorName}`,stock:r.totalStock,status:0===r.totalStock?"out":"low"})})});let f=(0,q.B$)(P.db,k.N9.ORDER_ITEMS),v=(0,q.IO)(f,(0,q.ar)("createdAt",">=",q.EK.fromDate(s)),(0,q.ar)("createdAt","<=",q.EK.fromDate(a))),y=await (0,q.PL)(v),j=new Map;y.docs.forEach(e=>{let t=e.data();if(!t||!t.variantId||!t.productName){console.warn("Skipping malformed order item from Firestore:",e.id);return}let r=t.variantId,s=`${t.productName} ${t.storageCapacity||""}`;j.has(r)||j.set(r,{name:s,sold:0,revenue:0});let a=j.get(r);a.sold+=t.quantity||0,a.revenue+=t.finalPrice||0});let N=Array.from(j.values()).sort((e,t)=>t.revenue-e.revenue).slice(0,5),w=await this.getStatsForDateRange(l,d),b={current:w.revenue,target:t,progress:t>0?w.revenue/t*100:0};return{success:!0,data:{todayStats:p,inventoryAlerts:g,topProducts:N,monthlyRevenue:b}}}catch(e){return this.handleError(e)}}}function A({className:e,...t}){return s.jsx("div",{className:(0,w.cn)("animate-pulse rounded-md bg-muted",e),...t})}function U({title:e,value:t,change:r,icon:a,formatAsCurrency:i=!1}){let o=r>=0;return(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n.ll,{className:"text-sm font-medium",children:e}),s.jsx(a,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(n.aY,{children:[s.jsx("div",{className:"text-2xl font-bold",children:i?`${t.toLocaleString("vi-VN")}₫`:t}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,s.jsxs)("span",{className:o?"text-green-600":"text-red-600",children:[o?"+":"",r.toFixed(1),"%"]})," ","so với h\xf4m qua"]})]})]})}function T(){return(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(A,{className:"h-4 w-36"}),s.jsx(A,{className:"h-4 w-4"})]}),(0,s.jsxs)(n.aY,{children:[s.jsx(A,{className:"h-8 w-48 mb-2"}),s.jsx(A,{className:"h-3 w-32"})]})]})}function L(){return(0,s.jsxs)("div",{className:"space-y-6 animate-pulse",children:[(0,s.jsxs)("div",{children:[s.jsx(A,{className:"h-8 w-48 mb-2"}),s.jsx(A,{className:"h-4 w-72"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(T,{}),s.jsx(T,{}),s.jsx(T,{}),s.jsx(T,{})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[s.jsx(A,{className:"h-6 w-40 mb-2"}),s.jsx(A,{className:"h-4 w-64"})]}),s.jsx(n.aY,{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 w-full",children:[s.jsx(A,{className:"h-10 w-10 rounded-md"}),(0,s.jsxs)("div",{className:"w-full space-y-2",children:[s.jsx(A,{className:"h-4 w-3/4"}),s.jsx(A,{className:"h-3 w-1/2"})]})]}),s.jsx(A,{className:"h-6 w-16"})]},t))})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[s.jsx(A,{className:"h-6 w-48 mb-2"}),s.jsx(A,{className:"h-4 w-80"})]}),s.jsx(n.aY,{className:"space-y-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 w-full",children:[s.jsx(A,{className:"w-8 h-8 rounded-lg"}),(0,s.jsxs)("div",{className:"w-full space-y-2",children:[s.jsx(A,{className:"h-4 w-3/5"}),s.jsx(A,{className:"h-3 w-2/5"})]})]}),s.jsx(A,{className:"h-5 w-24"})]},t))})]})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[s.jsx(A,{className:"h-6 w-64 mb-2"}),s.jsx(A,{className:"h-4 w-96"})]}),(0,s.jsxs)(n.aY,{children:[s.jsx(A,{className:"h-4 w-full rounded-full"}),(0,s.jsxs)("div",{className:"flex justify-between mt-2",children:[s.jsx(A,{className:"h-4 w-24"}),s.jsx(A,{className:"h-4 w-32"})]})]})]})]})}function $(){let[e,t]=(0,a.useState)(null),[r,o]=(0,a.useState)(!0),[l,d]=(0,a.useState)(null);if(r)return s.jsx(L,{});if(l||!e)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("p",{className:"text-red-500",children:l||"Could not load dashboard data."})});let{todayStats:c,inventoryAlerts:u,topProducts:m,monthlyRevenue:h}=e;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),s.jsx("p",{className:"text-gray-600",children:"Tổng quan hoạt động kinh doanh h\xf4m nay"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(U,{title:"Doanh thu h\xf4m nay",value:c.revenue,change:c.revenueChange,icon:S.Z,formatAsCurrency:!0}),s.jsx(U,{title:"Đơn h\xe0ng",value:c.orders,change:c.ordersChange,icon:I.Z}),s.jsx(U,{title:"Gi\xe1 trị đơn h\xe0ng TB",value:c.avgOrderValue,change:c.avgOrderValueChange,icon:D.Z,formatAsCurrency:!0}),s.jsx(U,{title:"Kh\xe1ch h\xe0ng",value:c.customers,change:c.customersChange,icon:O.Z})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[(0,s.jsxs)(n.ll,{className:"flex items-center",children:[s.jsx(E.Z,{className:"w-5 h-5 mr-2 text-orange-500"}),"Cảnh b\xe1o tồn kho"]}),s.jsx(n.SZ,{children:"C\xe1c sản phẩm sắp hết hoặc đ\xe3 hết h\xe0ng (ngưỡng: 5)"})]}),s.jsx(n.aY,{className:"space-y-4",children:u.length>0?u.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(_.Z,{className:"w-4 h-4 text-gray-500"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-sm",children:e.model}),s.jsx("p",{className:"text-xs text-gray-500",children:e.variant})]})]}),s.jsx("div",{className:"text-right",children:s.jsx(i.C,{variant:"out"===e.status?"destructive":"secondary",children:0===e.stock?"Hết h\xe0ng":`C\xf2n ${e.stock}`})})]},t)):s.jsx("p",{className:"text-sm text-gray-500",children:"Kh\xf4ng c\xf3 cảnh b\xe1o tồn kho."})})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[s.jsx(n.ll,{children:"Sản phẩm b\xe1n chạy"}),s.jsx(n.SZ,{children:"Top sản phẩm c\xf3 doanh thu cao nhất h\xf4m nay"})]}),s.jsx(n.aY,{className:"space-y-4",children:m.length>0?m.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-medium text-blue-600",children:t+1})}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-sm",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Đ\xe3 b\xe1n: ",e.sold," chiếc"]})]})]}),s.jsx("div",{className:"text-right",children:(0,s.jsxs)("p",{className:"font-medium text-sm",children:[e.revenue.toLocaleString("vi-VN"),"₫"]})})]},t)):s.jsx("p",{className:"text-sm text-gray-500",children:"Chưa c\xf3 sản phẩm n\xe0o được b\xe1n h\xf4m nay."})})]})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[s.jsx(n.ll,{children:"Tiến độ doanh thu th\xe1ng n\xe0y"}),(0,s.jsxs)(n.SZ,{children:["Mục ti\xeau: ",h.target.toLocaleString("vi-VN"),"₫ | Hiện tại:"," ",h.current.toLocaleString("vi-VN"),"₫"]})]}),(0,s.jsxs)(n.aY,{children:[s.jsx(b,{value:h.progress,className:"w-full"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 mt-2",children:[(0,s.jsxs)("span",{children:[h.progress.toFixed(1),"% ho\xe0n th\xe0nh"]}),(0,s.jsxs)("span",{children:["C\xf2n ",(h.target-h.current).toLocaleString("vi-VN"),"₫"]})]})]})]})]})}new M},2922:(e,t,r)=>{"use strict";r.d(t,{u:()=>l});var s=r(76),a=r(90445),n=r(90097),i=r(80413);class o extends n.bQ{constructor(){super(i.Ul.SALES_ORDERS)}async getAvailableProductsForSale(){try{let e=(0,s.hJ)(a.db,i.Ul.INVENTORY),t=(0,s.IO)(e,(0,s.ar)("status","in",i.sM)),r=await (0,s.PL)(t);if(r.empty)return{success:!0,data:[]};let n=r.docs.map(e=>({id:e.id,...e.data()})),o=new Map;for(let e of n){if(!e.productId||!e.variantId){console.warn(`Inventory item ${e.id} missing productId or variantId, skipping.`);continue}let t=o.get(e.productId);t||(t={productId:e.productId,productName:e.productName||"Unknown Product",variants:[]},o.set(e.productId,t));let r=t.variants.find(t=>t.variantId===e.variantId);r||(r={variantId:e.variantId,variantSku:e.variantSku||"Unknown SKU",colorName:e.colorName||"Unknown Color",storageCapacity:e.storageCapacity||"Unknown Storage",availableImeis:[],totalStock:0},t.variants.push(r)),r.availableImeis.push({inventoryItemId:e.id,imei:e.imei,currentRetailPrice:e.currentRetailPrice,entryDate:e.entryDate}),r.totalStock+=1}return{success:!0,data:Array.from(o.values())}}catch(e){return this.handleError(e)}}async createSaleOrder(e,t,r){try{let o,l=e.customerId;if(!l&&e.customerInfo?.phone&&e.customerInfo?.name){let t=(0,s.hJ)(a.db,i.Ul.CUSTOMERS),r=(0,s.IO)(t,(0,s.ar)("phone","==",e.customerInfo.phone),(0,s.b9)(1)),n=await (0,s.PL)(r);l=n.empty?(o=(0,s.JU)(t)).id:n.docs[0].id}return await this.runTransaction(async d=>{let c;let u=s.EK.now(),m=(0,s.JU)((0,s.hJ)(a.db,i.Ul.SALES_ORDERS)),h=(0,n.m1)("SO"),p=e.items.map(e=>(0,s.JU)(a.db,i.Ul.INVENTORY,e.inventoryItemId)),x=await Promise.all(p.map(e=>d.get(e)));if(l&&!o){let e=(0,s.JU)(a.db,i.Ul.CUSTOMERS,l);if(!(c=await d.get(e)).exists())throw Error(`Kh\xe1ch h\xe0ng với ID ${l} kh\xf4ng t\xecm thấy.`)}let g=0,f=[],v=[],y=[];for(let r=0;r<x.length;r++){let s=x[r],a=e.items[r];if(!s.exists())throw Error(`Sản phẩm với IMEI ${a.imei} kh\xf4ng t\xecm thấy trong kho.`);let n={id:s.id,...s.data()};if(n.imei!==a.imei)throw Error(`IMEI kh\xf4ng khớp cho sản phẩm ${a.inventoryItemId}.`);if(n.status!==i.eM.IN_STOCK)throw Error(`Sản phẩm ${n.productName} (${a.imei}) kh\xf4ng c\xf2n sẵn.`);let o=n.currentRetailPrice;g+=o,f.push({id:"temp-id",salesOrderId:m.id,inventoryItemId:n.id,imei:n.imei,productId:n.productId,variantId:n.variantId,productName:n.productName,variantSku:n.variantSku,colorName:n.colorName,storageCapacity:n.storageCapacity,quantity:1,unitCost:n.entryPrice,salePrice:o,itemDiscountAmount:0,itemTaxAmount:0,finalPrice:o,itemStatus:"fulfilled",entryDateOfItem:n.entryDate,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t}),v.push({ref:p[r],data:{status:i.eM.SOLD,lastStatusChange:u,salesOrderId:m.id,saleDate:u,actualSalePrice:o,warrantyStartDate:u}}),y.push({inventoryItemId:n.id,imei:n.imei,movementType:i.$D.SALE,timestamp:u,quantityChange:-1,previousStatus:i.eM.IN_STOCK,newStatus:i.eM.SOLD,fromLocation:n.currentLocation,toLocation:"Sold",userId:t,userRole:"pos_staff",reason:`B\xe1n h\xe0ng qua POS - Đơn ${h}`,relatedOrderId:m.id,relatedDocumentType:"sale",createdAt:u,updatedAt:u,createdBy:t,updatedBy:t})}if(o&&e.customerInfo?.name){let r={name:e.customerInfo.name,phone:e.customerInfo.phone,email:e.customerInfo.email||"",address:{street:e.customerInfo.address||"",city:"TP.HCM",type:"home"},acquisitionChannel:"walk_in"},a={...r,dateOfBirth:s.EK.now(),addresses:r.address?[{id:"default",street:r.address.street,city:r.address.city,country:"Vietnam",isDefault:!0,type:"home"}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:"phone",communicationPreferences:{promotions:!0,newProducts:!0,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:!1,isCorporate:!1,allowMarketing:!0,requiresApproval:!1,isActive:!0,isBlacklisted:!1,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};d.set(o,a)}let j=e.taxRate||0,N=g*j,w=e.discountAmount||0,b=e.shippingAmount||0,S=g+N-w+b,I={orderNumber:h,orderDate:u,customerInfo:e.customerInfo,subtotalAmount:g,taxRate:j,taxAmount:N,discountAmount:w,shippingAmount:b,totalAmount:S,paymentMethod:e.paymentMethod,paymentStatus:"paid",status:"completed",salesChannel:e.salesChannel||"pos",staffId:t,staffName:r||"",amountReceived:"cash"===e.paymentMethod?e.amountReceived:void 0,changeGiven:"cash"===e.paymentMethod&&e.amountReceived?e.amountReceived-S:void 0,totalItems:e.items.length,totalQuantity:e.items.length,notes:e.notes,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};if(l&&(I.customerId=l),d.set(m,I),l){let e=(0,s.JU)(a.db,i.Ul.CUSTOMERS,l),t=c?c.data():{totalOrders:0,totalSpent:0,firstPurchaseDate:u},r=(t.totalOrders||0)+1,n=(t.totalSpent||0)+S,o={totalOrders:r,totalSpent:n,averageOrderValue:n/r,lastPurchaseDate:u,firstPurchaseDate:t.firstPurchaseDate||u};d.update(e,o)}for(let e=0;e<f.length;e++){let{id:t,...r}=f[e],n=(0,s.JU)((0,s.hJ)(a.db,m.path,i.N9.ORDER_ITEMS));d.set(n,r),f[e].id=n.id}return v.forEach(e=>d.update(e.ref,e.data)),y.forEach(e=>{let t=(0,s.JU)((0,s.hJ)(a.db,i.Ul.STOCK_MOVEMENTS));d.set(t,e)}),{...I,id:m.id,items:f}})}catch(e){return console.error("Create sale order error:",e),this.handleError(e)}}async getSalesOrderByIdWithItems(e){try{let t=(0,s.JU)(a.db,i.Ul.SALES_ORDERS,e),r=await (0,s.QT)(t);if(!r.exists())return{success:!1,error:`Kh\xf4ng t\xecm thấy đơn h\xe0ng với ID: ${e}`,errorCode:"ORDER_NOT_FOUND"};let n={id:r.id,...r.data()},o=(0,s.hJ)(a.db,i.Ul.SALES_ORDERS,e,i.N9.ORDER_ITEMS),l=(await (0,s.PL)((0,s.IO)(o,(0,s.Xo)("createdAt","asc")))).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:{order:n,items:l}}}catch(t){return console.error(`Error fetching order ${e} with items:`,t),this.handleError(t)}}async getSalesOrdersByCustomerId(e){try{let t=(0,s.hJ)(a.db,i.Ul.SALES_ORDERS),r=(0,s.IO)(t,(0,s.ar)("customerId","==",e),(0,s.Xo)("orderDate","desc")),n=(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:n}}catch(e){return this.handleError(e)}}}let l=new o},70180:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`D:\phone_store_management\phone_store_management\src\app\(main)\dashboard\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[560,367,738,530,479,478],()=>r(63203));module.exports=s})();