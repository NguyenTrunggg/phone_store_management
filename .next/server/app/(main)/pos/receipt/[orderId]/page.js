(()=>{var e={};e.id=586,e.ids=[586],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},85406:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>l,routeModule:()=>p,tree:()=>c}),r(3077),r(58522),r(35866),r(26682);var s=r(23191),a=r(88716),n=r(37922),i=r.n(n),o=r(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let c=["",{children:["(main)",{children:["pos",{children:["receipt",{children:["[orderId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3077)),"D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\pos\\receipt\\[orderId]\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,26682)),"D:\\phone_store_management\\phone_store_management\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],l=["D:\\phone_store_management\\phone_store_management\\src\\app\\(main)\\pos\\receipt\\[orderId]\\page.tsx"],u="/(main)/pos/receipt/[orderId]/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/pos/receipt/[orderId]/page",pathname:"/pos/receipt/[orderId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},87491:(e,t,r)=>{Promise.resolve().then(r.bind(r,65657))},75290:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(76557).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},65657:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(10326),a=r(17577),n=r(35047);r(2922);var i=r(29752),o=r(91664),d=r(72427),c=r(75290),l=r(76557);let u=(0,l.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var m=r(83495);let p=(0,l.Z)("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);r(85999);var h=r(90097);function x(){let e=(0,n.useRouter)();(0,n.useParams)().orderId;let[t,r]=(0,a.useState)(null),[l,x]=(0,a.useState)(!0),[y,f]=(0,a.useState)(null);if(l)return(0,s.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[s.jsx(c.Z,{className:"h-12 w-12 animate-spin text-blue-500"}),s.jsx("p",{className:"ml-3 text-lg",children:"Đang tải h\xf3a đơn..."})]});if(y||!t)return(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen text-center",children:[s.jsx("p",{className:"text-xl text-red-500 mb-4",children:y||"Kh\xf4ng t\xecm thấy th\xf4ng tin h\xf3a đơn."}),(0,s.jsxs)(o.z,{onClick:()=>e.push("/pos"),children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"Quay lại POS"]})]});let{order:g,items:v}=t;return s.jsx("div",{className:"max-w-2xl mx-auto p-4 sm:p-6 lg:p-8 bg-white",children:(0,s.jsxs)(i.Zb,{className:"shadow-lg",children:[s.jsx(i.Ol,{className:"bg-gray-50 p-6 rounded-t-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx(i.ll,{className:"text-2xl font-bold text-gray-800",children:"H\xf3a Đơn B\xe1n H\xe0ng"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["M\xe3 đơn h\xe0ng: ",g.orderNumber]})]}),s.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:s.jsx(m.Z,{className:"w-5 h-5 text-white"})})]})}),(0,s.jsxs)(i.aY,{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-700 mb-1",children:"Th\xf4ng tin kh\xe1ch h\xe0ng:"}),(0,s.jsxs)("p",{children:["T\xean: ",g.customerInfo?.name||"Kh\xe1ch lẻ"]}),(0,s.jsxs)("p",{children:["Điện thoại: ",g.customerInfo?.phone||"N/A"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[s.jsx("h3",{className:"font-semibold text-gray-700 mb-1",children:"Ng\xe0y tạo h\xf3a đơn:"}),s.jsx("p",{children:(0,h.p6)(g.orderDate)}),s.jsx("h3",{className:"font-semibold text-gray-700 mt-2 mb-1",children:"Nh\xe2n vi\xean:"}),s.jsx("p",{children:g.staffName||g.staffId})]})]}),s.jsx(d.Z,{}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-700 mb-3 text-lg",children:"Chi tiết sản phẩm:"}),s.jsx("div",{className:"space-y-3",children:v.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-start p-3 bg-gray-50 rounded-md",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-gray-800",children:e.productName}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[e.storageCapacity," - ",e.colorName," (IMEI: ",e.imei,")"]})]}),s.jsx("p",{className:"font-semibold text-gray-800",children:(0,h.xG)(e.finalPrice)})]},e.id))})]}),s.jsx(d.Z,{}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Tạm t\xednh:"}),s.jsx("span",{className:"font-medium text-gray-800",children:(0,h.xG)(g.subtotalAmount)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Thuế VAT (",100*g.taxRate,"%):"]}),s.jsx("span",{className:"font-medium text-gray-800",children:(0,h.xG)(g.taxAmount)})]}),g.discountAmount>0&&(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Giảm gi\xe1:"}),(0,s.jsxs)("span",{className:"font-medium text-red-600",children:["-",(0,h.xG)(g.discountAmount)]})]}),g.shippingAmount>0&&(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Ph\xed vận chuyển:"}),s.jsx("span",{className:"font-medium text-gray-800",children:(0,h.xG)(g.shippingAmount)})]}),s.jsx(d.Z,{className:"my-2"}),(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold text-blue-600",children:[s.jsx("span",{children:"Tổng cộng:"}),s.jsx("span",{children:(0,h.xG)(g.totalAmount)})]})]}),s.jsx(d.Z,{}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Th\xf4ng tin thanh to\xe1n:"}),(0,s.jsxs)("p",{className:"text-sm",children:["Phương thức: ","cash"===g.paymentMethod?"Tiền mặt":"card"===g.paymentMethod?"Thẻ ng\xe2n h\xe0ng":"Chuyển khoản"]}),"cash"===g.paymentMethod&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"text-sm",children:["Tiền kh\xe1ch đưa: ",(0,h.xG)(g.amountReceived||0)]}),(0,s.jsxs)("p",{className:"text-sm",children:["Tiền trả lại: ",(0,h.xG)(g.changeGiven||0)]})]})]}),s.jsx("p",{className:"text-xs text-center text-gray-500 pt-4",children:"Cảm ơn qu\xfd kh\xe1ch đ\xe3 mua h\xe0ng!"})]}),(0,s.jsxs)(i.eW,{className:"p-6 bg-gray-50 rounded-b-lg flex justify-end space-x-3",children:[(0,s.jsxs)(o.z,{variant:"outline",onClick:()=>e.push("/pos"),children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"Tạo đơn mới"]}),(0,s.jsxs)(o.z,{onClick:()=>{window.print()},children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"In h\xf3a đơn"]})]})]})})}},72427:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(10326),a=r(17577),n=r(45226),i="horizontal",o=["horizontal","vertical"],d=a.forwardRef((e,t)=>{let{decorative:r,orientation:a=i,...d}=e,c=o.includes(a)?a:i;return(0,s.jsx)(n.WV.div,{"data-orientation":c,...r?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...d,ref:t})});d.displayName="Separator";var c=r(51223);let l=a.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...a},n)=>s.jsx(d,{ref:n,decorative:r,orientation:t,className:(0,c.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a}));l.displayName=d.displayName},2922:(e,t,r)=>{"use strict";r.d(t,{u:()=>d});var s=r(76),a=r(90445),n=r(90097),i=r(80413);class o extends n.bQ{constructor(){super(i.Ul.SALES_ORDERS)}async getAvailableProductsForSale(){try{let e=(0,s.hJ)(a.db,i.Ul.INVENTORY),t=(0,s.IO)(e,(0,s.ar)("status","in",i.sM)),r=await (0,s.PL)(t);if(r.empty)return{success:!0,data:[]};let n=r.docs.map(e=>({id:e.id,...e.data()})),o=new Map;for(let e of n){if(!e.productId||!e.variantId){console.warn(`Inventory item ${e.id} missing productId or variantId, skipping.`);continue}let t=o.get(e.productId);t||(t={productId:e.productId,productName:e.productName||"Unknown Product",variants:[]},o.set(e.productId,t));let r=t.variants.find(t=>t.variantId===e.variantId);r||(r={variantId:e.variantId,variantSku:e.variantSku||"Unknown SKU",colorName:e.colorName||"Unknown Color",storageCapacity:e.storageCapacity||"Unknown Storage",availableImeis:[],totalStock:0},t.variants.push(r)),r.availableImeis.push({inventoryItemId:e.id,imei:e.imei,currentRetailPrice:e.currentRetailPrice,entryDate:e.entryDate}),r.totalStock+=1}return{success:!0,data:Array.from(o.values())}}catch(e){return this.handleError(e)}}async createSaleOrder(e,t,r){try{let o,d=e.customerId;if(!d&&e.customerInfo?.phone&&e.customerInfo?.name){let t=(0,s.hJ)(a.db,i.Ul.CUSTOMERS),r=(0,s.IO)(t,(0,s.ar)("phone","==",e.customerInfo.phone),(0,s.b9)(1)),n=await (0,s.PL)(r);d=n.empty?(o=(0,s.JU)(t)).id:n.docs[0].id}return await this.runTransaction(async c=>{let l;let u=s.EK.now(),m=(0,s.JU)((0,s.hJ)(a.db,i.Ul.SALES_ORDERS)),p=(0,n.m1)("SO"),h=e.items.map(e=>(0,s.JU)(a.db,i.Ul.INVENTORY,e.inventoryItemId)),x=await Promise.all(h.map(e=>c.get(e)));if(d&&!o){let e=(0,s.JU)(a.db,i.Ul.CUSTOMERS,d);if(!(l=await c.get(e)).exists())throw Error(`Kh\xe1ch h\xe0ng với ID ${d} kh\xf4ng t\xecm thấy.`)}let y=0,f=[],g=[],v=[];for(let r=0;r<x.length;r++){let s=x[r],a=e.items[r];if(!s.exists())throw Error(`Sản phẩm với IMEI ${a.imei} kh\xf4ng t\xecm thấy trong kho.`);let n={id:s.id,...s.data()};if(n.imei!==a.imei)throw Error(`IMEI kh\xf4ng khớp cho sản phẩm ${a.inventoryItemId}.`);if(n.status!==i.eM.IN_STOCK)throw Error(`Sản phẩm ${n.productName} (${a.imei}) kh\xf4ng c\xf2n sẵn.`);let o=n.currentRetailPrice;y+=o,f.push({id:"temp-id",salesOrderId:m.id,inventoryItemId:n.id,imei:n.imei,productId:n.productId,variantId:n.variantId,productName:n.productName,variantSku:n.variantSku,colorName:n.colorName,storageCapacity:n.storageCapacity,quantity:1,unitCost:n.entryPrice,salePrice:o,itemDiscountAmount:0,itemTaxAmount:0,finalPrice:o,itemStatus:"fulfilled",entryDateOfItem:n.entryDate,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t}),g.push({ref:h[r],data:{status:i.eM.SOLD,lastStatusChange:u,salesOrderId:m.id,saleDate:u,actualSalePrice:o,warrantyStartDate:u}}),v.push({inventoryItemId:n.id,imei:n.imei,movementType:i.$D.SALE,timestamp:u,quantityChange:-1,previousStatus:i.eM.IN_STOCK,newStatus:i.eM.SOLD,fromLocation:n.currentLocation,toLocation:"Sold",userId:t,userRole:"pos_staff",reason:`B\xe1n h\xe0ng qua POS - Đơn ${p}`,relatedOrderId:m.id,relatedDocumentType:"sale",createdAt:u,updatedAt:u,createdBy:t,updatedBy:t})}if(o&&e.customerInfo?.name){let r={name:e.customerInfo.name,phone:e.customerInfo.phone,email:e.customerInfo.email||"",address:{street:e.customerInfo.address||"",city:"TP.HCM",type:"home"},acquisitionChannel:"walk_in"},a={...r,dateOfBirth:s.EK.now(),addresses:r.address?[{id:"default",street:r.address.street,city:r.address.city,country:"Vietnam",isDefault:!0,type:"home"}]:[],totalOrders:0,totalSpent:0,averageOrderValue:0,customerTier:"new",loyaltyPoints:0,lifetimeValue:0,preferredContactMethod:"phone",communicationPreferences:{promotions:!0,newProducts:!0,appointments:!0,orderUpdates:!0,warrantyReminders:!0},isVip:!1,isCorporate:!1,allowMarketing:!0,requiresApproval:!1,isActive:!0,isBlacklisted:!1,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};c.set(o,a)}let j=e.taxRate||0,I=y*j,N=e.discountAmount||0,b=e.shippingAmount||0,S=y+I-N+b,w={orderNumber:p,orderDate:u,customerInfo:e.customerInfo,subtotalAmount:y,taxRate:j,taxAmount:I,discountAmount:N,shippingAmount:b,totalAmount:S,paymentMethod:e.paymentMethod,paymentStatus:"paid",status:"completed",salesChannel:e.salesChannel||"pos",staffId:t,staffName:r||"",amountReceived:"cash"===e.paymentMethod?e.amountReceived:void 0,changeGiven:"cash"===e.paymentMethod&&e.amountReceived?e.amountReceived-S:void 0,totalItems:e.items.length,totalQuantity:e.items.length,notes:e.notes,createdAt:u,updatedAt:u,createdBy:t,updatedBy:t};if(d&&(w.customerId=d),c.set(m,w),d){let e=(0,s.JU)(a.db,i.Ul.CUSTOMERS,d),t=l?l.data():{totalOrders:0,totalSpent:0,firstPurchaseDate:u},r=(t.totalOrders||0)+1,n=(t.totalSpent||0)+S,o={totalOrders:r,totalSpent:n,averageOrderValue:n/r,lastPurchaseDate:u,firstPurchaseDate:t.firstPurchaseDate||u};c.update(e,o)}for(let e=0;e<f.length;e++){let{id:t,...r}=f[e],n=(0,s.JU)((0,s.hJ)(a.db,m.path,i.N9.ORDER_ITEMS));c.set(n,r),f[e].id=n.id}return g.forEach(e=>c.update(e.ref,e.data)),v.forEach(e=>{let t=(0,s.JU)((0,s.hJ)(a.db,i.Ul.STOCK_MOVEMENTS));c.set(t,e)}),{...w,id:m.id,items:f}})}catch(e){return console.error("Create sale order error:",e),this.handleError(e)}}async getSalesOrderByIdWithItems(e){try{let t=(0,s.JU)(a.db,i.Ul.SALES_ORDERS,e),r=await (0,s.QT)(t);if(!r.exists())return{success:!1,error:`Kh\xf4ng t\xecm thấy đơn h\xe0ng với ID: ${e}`,errorCode:"ORDER_NOT_FOUND"};let n={id:r.id,...r.data()},o=(0,s.hJ)(a.db,i.Ul.SALES_ORDERS,e,i.N9.ORDER_ITEMS),d=(await (0,s.PL)((0,s.IO)(o,(0,s.Xo)("createdAt","asc")))).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:{order:n,items:d}}}catch(t){return console.error(`Error fetching order ${e} with items:`,t),this.handleError(t)}}async getSalesOrdersByCustomerId(e){try{let t=(0,s.hJ)(a.db,i.Ul.SALES_ORDERS),r=(0,s.IO)(t,(0,s.ar)("customerId","==",e),(0,s.Xo)("orderDate","desc")),n=(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,data:n}}catch(e){return this.handleError(e)}}}let d=new o},3077:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`D:\phone_store_management\phone_store_management\src\app\(main)\pos\receipt\[orderId]\page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[560,367,738,999,530,479,478],()=>r(85406));module.exports=s})();